<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navy PT Generator | Command PT Session Builder</title>
    <meta name="description"
        content="Generate safe, effective 60-minute Navy physical training sessions for Command PT. Print-ready format for CFLs and ACFLs.">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öì</text></svg>">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4254899096040096"
        crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7D2BBFK1WP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7D2BBFK1WP');
    </script>

    <style>
        /* Base Styles - Matching index.html */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1829 100%);
            min-height: 100vh;
            color: #e8eef5;
            line-height: 1.6;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(90deg, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        .subtitle {
            color: #8fa3bf;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .btn-back {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calculator-card {
            background: rgba(20, 35, 60, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(100, 130, 180, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 30px;
            margin-bottom: 30px;
        }

        .card-header {
            border-bottom: 1px solid rgba(100, 130, 180, 0.2);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .card-header h2 {
            color: #ffd700;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #8fa3bf;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin-bottom: 25px;
        }

        .controls-grid .form-group {
            background: rgba(10, 20, 36, 0.65);
            border: 1px solid rgba(74, 144, 226, 0.25);
            border-radius: 12px;
            padding: 16px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
        }

        .controls-grid .form-group label {
            margin-bottom: 8px;
        }

        .group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .group-title {
            font-size: 12px;
            font-weight: 600;
            color: #8fa3bf;
            text-transform: uppercase;
            letter-spacing: 1px;
            flex: 1 1 140px;
        }

        .equip-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .equip-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            border: 1px solid rgba(100, 130, 180, 0.3);
            transition: all 0.2s;
        }

        .equip-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .equip-checkbox.none-selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .equip-checkbox input {
            accent-color: #ffd700;
        }

        .equip-checkbox.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        .toggle-pill {
            display: inline-flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            font-size: 0.85em;
            color: #dfe7f3;
            cursor: pointer;
            user-select: none;
            width: 100%;
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(100, 130, 180, 0.35);
            background: rgba(15, 25, 40, 0.45);
        }

        .group-header .toggle-pill {
            width: auto;
            padding: 6px 12px;
            flex: 1 1 180px;
            justify-content: space-between;
        }

        .toggle-pill-text {
            letter-spacing: 0.4px;
            text-transform: none;
        }

        .toggle-pill input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .toggle-pill-track {
            position: relative;
            width: 34px;
            height: 18px;
            background: rgba(216, 222, 231, 0.7);
            border-radius: 999px;
            transition: background 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.12);
        }

        .toggle-pill-track::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 2px;
            width: 14px;
            height: 14px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .toggle-pill input:checked + .toggle-pill-track {
            background: #4a90e2;
        }

        .toggle-pill input:checked + .toggle-pill-track::after {
            transform: translateX(16px);
        }

        .injury-options {
            display: grid;
            grid-template-columns: repeat(2, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .injury-options .equip-checkbox {
            font-size: 0.8em;
            padding: 6px 10px;
        }

        .injury-options p {
            grid-column: 1 / -1;
        }

        .helper-text {
            font-size: 11px;
            color: #8fa3bf;
            margin-top: 6px;
            line-height: 1.4;
        }

        .helper-text.tight {
            margin: 8px 0 10px;
            font-style: italic;
        }

        .equip-grid.disabled {
            opacity: 0.5;
        }

        select {
            width: 100%;
            padding: 12px;
            background: #1e3250;
            border: 1px solid #4a90e2;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        select:focus {
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
        }

        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(30, 50, 80, 0.3);
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
            color: #0a1628;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        /* Ad Container Styles */
        .ad-container {
            background: rgba(30, 50, 80, 0.3);
            border: 1px dashed rgba(100, 130, 180, 0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            min-height: 90px;
        }

        .ad-container.large {
            min-height: 250px;
        }

        .ad-label {
            color: #6b7c94;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* PPAQ Section - Inline (Not Popup) */
        .ppaq-section {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .ppaq-title {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ppaq-list {
            font-size: 0.95em;
        }

        .ppaq-item {
            padding: 8px 0;
            display: flex;
            gap: 10px;
            border-bottom: 1px dashed rgba(255, 215, 0, 0.1);
        }

        .ppaq-item:last-child {
            border-bottom: none;
        }

        .ppaq-number {
            color: #ffd700;
            font-weight: bold;
            min-width: 25px;
        }

        .ppaq-warning {
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 15px;
            font-size: 0.9em;
            text-align: center;
        }

        /* Workout Output */
        #workoutOutput {
            display: none;
            margin-top: 30px;
            border-top: 1px solid rgba(100, 130, 180, 0.3);
            padding-top: 30px;
        }

        .section-header {
            color: #ffd700;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 10px;
            margin: 30px 0 15px 0;
        }

        .section-header:first-child {
            margin-top: 0;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-item {
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-left: 3px solid #4a90e2;
        }

        .exercise-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .exercise-main {
            min-width: 200px;
        }

        .exercise-alt {
            min-width: 200px;
            text-align: right;
            color: #d1e6ff;
        }

        .exercise-alt-label {
            display: block;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: #8fa3bf;
        }

        .exercise-alt-name {
            font-size: 0.95em;
            font-weight: 600;
        }

        .exercise-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #fff;
        }

        .exercise-meta {
            font-size: 0.9em;
            color: #8fa3bf;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
        }

        .exercise-meta .meta-text {
            font-weight: 600;
            color: #8fa3bf;
        }

        .exercise-meta .meta-pill {
            font-size: 0.65em;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(74, 144, 226, 0.15);
            border: 1px solid rgba(74, 144, 226, 0.4);
            color: #cfe2ff;
        }

        .exercise-meta .meta-pill.core {
            background: rgba(255, 215, 0, 0.12);
            border-color: rgba(255, 215, 0, 0.6);
            color: #ffd700;
        }

        .search-link {
            color: #4a90e2;
            text-decoration: none;
            font-size: 0.85em;
            display: inline-block;
            margin-top: 5px;
        }

        .search-link:hover {
            text-decoration: underline;
            color: #ffd700;
        }

        footer {
            text-align: center;
            color: #6b7c94;
            font-size: 12px;
            padding: 30px;
        }

        footer a {
            color: #8fa3bf;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            line-height: 1.4;
            padding: 2px 4px;
        }

        footer a:hover {
            color: #ffd700;
        }

        /* PT Banner */
        .pt-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px 30px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .pt-banner-text {
            flex: 1;
        }

        .pt-banner-text h3 {
            color: #ffd700;
            margin: 0 0 8px 0;
            font-size: 20px;
        }

        .pt-banner-text p {
            color: #e8eef5;
            margin: 0;
            font-size: 14px;
        }

        .pt-banner-btn {
            background: linear-gradient(135deg, #ffd700, #b8860b);
            color: #0a1628;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .pt-banner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        /* Mobile responsive PT banner */
        @media (max-width: 768px) {
            .pt-banner {
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
                gap: 15px;
            }

            .pt-banner-text h3 {
                font-size: 18px;
            }

            .pt-banner-text p {
                font-size: 13px;
            }

            .pt-banner-btn {
                width: 100%;
                text-align: center;
                white-space: normal;
                padding: 14px 20px;
            }
        }

        /* Skip to Content Link - Accessibility */
        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            .container {
                max-width: 100%;
                padding: 10px;
            }

            .btn-back,
            .action-btn,
            .search-link,
            .ad-container,
            .pt-banner {
                display: none !important;
            }

            header {
                padding: 10px 0;
            }

            h1 {
                -webkit-text-fill-color: black !important;
                color: black !important;
                font-size: 24px;
            }

            .subtitle {
                color: #666 !important;
            }

            .calculator-card {
                background: white !important;
                border: 1px solid #ccc;
                box-shadow: none;
                padding: 15px;
            }

            .ppaq-section {
                background: #f9f9f9 !important;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }

            .ppaq-title {
                color: #333 !important;
            }

            .ppaq-number {
                color: #333 !important;
            }

            .ppaq-warning {
                color: red !important;
            }

            .section-header {
                color: #333 !important;
                border-color: #333 !important;
            }

            .exercise-item {
                background: #f5f5f5 !important;
                border-left-color: #333 !important;
                page-break-inside: avoid;
            }

            .exercise-name {
                color: black !important;
            }

            .exercise-meta {
                color: #666 !important;
            }

            footer {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Top Ad Banner -->
        <div class="ad-container">
            <span class="ad-label">Advertisement</span>
        </div>

        <header>
            <div class="logo-container">
                <div class="logo">‚öì</div>
                <h1>Navy PT Generator</h1>
            </div>
            <p class="subtitle">Command Physical Training Session Builder</p>
            <nav class="site-nav" aria-label="Primary">
                <a href="index.html">BCA Calculator</a>
                <a href="generator.html" class="active">PT Generator</a>
                <a href="exercises.html">Exercise Library</a>
                <a href="watchbill.html">Watchbill</a>
                <a href="prt-prep.html">PRT Prep</a>
                <a href="references.html">References</a>
                <a href="about.html">About</a>
            </nav>
        </header>

        <main id="main-content" class="calculator-card">
            <!-- PPAQ Section - Always Visible for CFLs -->
            <div class="ppaq-section">
                <div class="ppaq-title">üìã Pre-Physical Activity Questions (PPAQ)</div>
                <p style="font-size: 0.85em; color: #8fa3bf; margin-bottom: 15px;">CFLs/ACFLs: Read aloud before each
                    session.</p>
                <div class="ppaq-list">
                    <div class="ppaq-item"><span class="ppaq-number">1.</span><span>Do you have a current Periodic
                            Health Assessment (PHA)?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">2.</span><span>Do you have chest pain, bone/joint
                            pain, high blood pressure, or high cholesterol?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">3.</span><span>Do you have Sickle Cell Trait
                            (SCT)?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">4.</span><span>Have you had a change in medical
                            status since your last PHA?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">5.</span><span>Are you ill today or aware of any
                            condition preventing participation?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">6.</span><span>Reservists (if applicable): Are you on active duty
                            orders or in drill status?</span></div>
                </div>
                <p class="ppaq-warning">‚ö†Ô∏è If YES to risk factors or NO to PHA/Clearance ‚áí Do NOT Participate.</p>
            </div>

            <!-- Controls -->
            <div class="card-header">
                <h2>Session Options</h2>
            </div>
            <div class="controls-grid">
                <div class="form-group">
                    <label>Focus</label>
                    <select id="focusSelect">
                        <option value="mixed">Mixed (Strength & Cardio)</option>
                        <option value="strength">Strength Focus</option>
                        <option value="cardio">Cardio Focus</option>
                        <option value="funday">Fun Day (Team Sports)</option>
                        <option value="yoga">Chill Day (Yoga/Stretching)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <select id="locationSelect">
                        <option value="outdoor">Outdoor</option>
                        <option value="indoor">Indoor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Rep Scheme</label>
                    <select id="schemeSelect">
                        <option value="surprise">Surprise Me!</option>
                        <option value="circuit">Circuit (3 Rounds x Reps)</option>
                        <option value="hiit">HIIT (40s Work / 20s Rest)</option>
                        <option value="military">Military 4-Count (10 reps)</option>
                        <option value="pyramid">Pyramid (2-4-6-8-10)</option>
                        <option value="reversePyramid">Reverse Pyramid (10-8-6-4-2)</option>
                    </select>
                </div>
                <div class="form-group" id="lowImpactGroup">
                    <div class="group-header">
                        <span class="group-title">Low Impact / Injured Mode</span>
                        <label class="toggle-pill">
                            <input type="checkbox" id="lowImpactToggle">
                            <span class="toggle-pill-track"></span>
                            <span class="toggle-pill-text">Low-impact alternatives</span>
                        </label>
                    </div>
                    <div class="injury-options" id="injuryOptions" style="display:none;">
                        <p class="helper-text tight">
                            Select your injured area. Those exercises will be replaced with alternatives.
                        </p>
                        <label class="equip-checkbox injury-select">
                            <input type="checkbox" id="injuryUpper"> Upper Body Injured
                        </label>
                        <label class="equip-checkbox injury-select">
                            <input type="checkbox" id="injuryLower"> Lower Body Injured
                        </label>
                    </div>
                </div>

                <div class="form-group" id="warmupStyleGroup">
                    <div class="group-header">
                        <span class="group-title">Warm-Up Style</span>
                        <label class="toggle-pill">
                            <input type="checkbox" id="randomWarmupToggle">
                            <span class="toggle-pill-track"></span>
                            <span class="toggle-pill-text">Randomize warm-up exercises</span>
                        </label>
                    </div>
                    <p class="helper-text">
                        Standard uses official Navy NOFFS warm-up sequence. Random picks varied exercises each session.
                    </p>
                </div>
            </div>

            <div class="form-group" id="fundayEquipmentGroup" style="display: none;">
                <label>Available Equipment/Facilities for Fun Day</label>

                <!-- No Equipment Option -->
                <div class="equip-grid" style="margin-bottom: 15px;">
                    <label class="equip-checkbox none-selected" id="fundayNoneLabel">
                        <input type="checkbox" id="fundayNoEquip" checked onchange="toggleFundayNone()"> No Equipment (Games Only)
                    </label>
                </div>

                <!-- Playing Areas -->
                <div id="fundayFacilitiesSection">
                    <label style="font-size: 11px; color: #6b7c94; margin-bottom: 8px; display: block;">PLAYING AREAS / FACILITIES</label>
                    <div class="equip-grid" style="margin-bottom: 20px;">
                        <label class="equip-checkbox" id="fundayBaseballFieldLabel">
                            <input type="checkbox" class="funday-facility" id="fundayBaseballField" onchange="fundayEquipChanged()"> Baseball/Softball Field
                        </label>
                        <label class="equip-checkbox" id="fundayBasketballCourtLabel">
                            <input type="checkbox" class="funday-facility" id="fundayBasketballCourt" onchange="fundayEquipChanged()"> Basketball Court
                        </label>
                        <label class="equip-checkbox" id="fundayOpenFieldLabel">
                            <input type="checkbox" class="funday-facility" id="fundayOpenField" onchange="fundayEquipChanged()"> Open Field
                        </label>
                        <label class="equip-checkbox" id="fundayTrackLabel">
                            <input type="checkbox" class="funday-facility" id="fundayTrack" onchange="fundayEquipChanged()"> Track/Running Path
                        </label>
                        <label class="equip-checkbox" id="fundayVolleyballCourtLabel">
                            <input type="checkbox" class="funday-facility" id="fundayVolleyballCourt" onchange="fundayEquipChanged()"> Volleyball Court
                        </label>
                    </div>

                    <!-- Equipment -->
                    <label style="font-size: 11px; color: #6b7c94; margin-bottom: 8px; display: block;">AVAILABLE EQUIPMENT</label>
                    <div class="equip-grid">
                        <label class="equip-checkbox" id="fundayBaseballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayBaseball" onchange="fundayEquipChanged()"> Softballs/Bats
                        </label>
                        <label class="equip-checkbox" id="fundayBasketballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayBasketball" onchange="fundayEquipChanged()"> Basketball
                        </label>
                        <label class="equip-checkbox" id="fundayConesLabel">
                            <input type="checkbox" class="funday-equip" id="fundayCones" onchange="fundayEquipChanged()"> Cones/Markers
                        </label>
                        <label class="equip-checkbox" id="fundayDodgeballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayDodgeball" onchange="fundayEquipChanged()"> Dodgeballs
                        </label>
                        <label class="equip-checkbox" id="fundayFlagSetLabel">
                            <input type="checkbox" class="funday-equip" id="fundayFlagSet" onchange="fundayEquipChanged()"> Flag Set
                        </label>
                        <label class="equip-checkbox" id="fundayFootballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayFootball" onchange="fundayEquipChanged()"> Football
                        </label>
                        <label class="equip-checkbox" id="fundayFrisbeeLabel">
                            <input type="checkbox" class="funday-equip" id="fundayFrisbee" onchange="fundayEquipChanged()"> Frisbee
                        </label>
                        <label class="equip-checkbox" id="fundayKickballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayKickball" onchange="fundayEquipChanged()"> Kickball
                        </label>
                        <label class="equip-checkbox" id="fundaySoccerLabel">
                            <input type="checkbox" class="funday-equip" id="fundaySoccer" onchange="fundayEquipChanged()"> Soccer Ball
                        </label>
                        <label class="equip-checkbox" id="fundayTugRopeLabel">
                            <input type="checkbox" class="funday-equip" id="fundayTugRope" onchange="fundayEquipChanged()"> Tug-of-War Rope
                        </label>
                        <label class="equip-checkbox" id="fundayVolleyballLabel">
                            <input type="checkbox" class="funday-equip" id="fundayVolleyball" onchange="fundayEquipChanged()"> Volleyball
                        </label>
                    </div>
                </div>
                <p class="hint" style="margin-top: 10px; color: #8fa3bf;">üí° "No Equipment" mode: Select facilities to get location-specific no-equipment games (e.g., Track = relay races, Field = capture the flag). Or choose equipment for traditional sports.</p>
            </div>

            <div class="form-group" id="equipmentGroup">
                <label>Equipment Available</label>
                <div class="equip-grid" id="equipmentGrid">
                    <label class="equip-checkbox none-selected">
                        <input type="checkbox" id="equipNone" checked onchange="toggleNone()"> None (Bodyweight Only)
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipAdjBench" onchange="equipChanged()"> Adjustable Bench
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipAssaultBike" onchange="equipChanged()"> Assault Bike
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipBarbell" onchange="equipChanged()"> Barbell
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipBicycle" onchange="equipChanged()"> Bicycles
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipDumbbells" onchange="equipChanged()"> Dumbbells
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipFlatBench" onchange="equipChanged()"> Flat Bench
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipJumprope" onchange="equipChanged()"> Jump Rope
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipKettlebells" onchange="equipChanged()"> Kettlebells
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipPullup" onchange="equipChanged()"> Pull-up Bar
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipBands" onchange="equipChanged()"> Resistance Bands
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipRower" onchange="equipChanged()"> Rowing Machine
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipCycle" onchange="equipChanged()"> Stationary Cycle
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipTreadmill" onchange="equipChanged()"> Treadmill
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipSwimming" onchange="equipChanged()"> Swimming Pool
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipSled" onchange="equipChanged()"> Weight Sled
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label>Remember Settings</label>
                <label class="toggle-pill">
                    <input type="checkbox" id="rememberPtToggle">
                    <span class="toggle-pill-track"></span>
                    <span class="toggle-pill-text">Save selections on this device</span>
                </label>
            </div>

            <button class="action-btn" onclick="generateWorkout()">Generate 60-Minute Session</button>

            <!-- Mid-Section Ad -->
            <div class="ad-container">
                <span class="ad-label">Advertisement</span>
            </div>

            <div id="workoutOutput"></div>

            <!-- Export Buttons -->
            <div id="exportSection" style="display: none; margin-top: 25px; gap: 10px; flex-wrap: wrap;">
                <button type="button" style="flex: 1; min-width: 150px; padding: 12px 20px; background: rgba(74, 144, 226, 0.2); border: 2px solid rgba(74, 144, 226, 0.4); border-radius: 8px; color: #4a90e2; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px;" onclick="exportWorkoutToCSV()" onmouseover="this.style.background='rgba(74, 144, 226, 0.3)'; this.style.borderColor='#4a90e2'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(74, 144, 226, 0.2)'; this.style.borderColor='rgba(74, 144, 226, 0.4)'; this.style.transform='translateY(0)'">
                    üìä Export to CSV
                </button>
                <button type="button" style="flex: 1; min-width: 150px; padding: 12px 20px; background: rgba(239, 68, 68, 0.2); border: 2px solid rgba(239, 68, 68, 0.4); border-radius: 8px; color: #ef4444; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px;" onclick="exportWorkoutToPDF()" onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'; this.style.borderColor='#ef4444'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'; this.style.borderColor='rgba(239, 68, 68, 0.4)'; this.style.transform='translateY(0)'">
                    üìÑ Print / Save PDF
                </button>
            </div>

            <p style="margin-top: 20px; font-size: 12px; color: #6b7c94; text-align: center;">
                * All exercises filtered to remove contraindicated movements per NOFFS guidelines.
            </p>
        </main>

        <!-- Large Ad Unit -->
        <div class="ad-container large">
            <span class="ad-label">Advertisement</span>
        </div>

        <footer>
            <p>Based on Navy Physical Readiness Program Guide-4 (December 2025)</p>
            <p style="margin-top: 10px;">Disclaimer: This site is not an official U.S. Navy website. This is an unofficial tool for planning purposes only.</p>
            <p style="margin-top: 12px;">
                <a href="privacy.html">Privacy</a> ‚Ä¢
                <a href="terms.html">Terms of Use</a> ‚Ä¢
                <a href="mailto:administrator@navybca.com">Contact</a>
            </p>
        </footer>
    </div>

    <script>
        // --- Data: Official Lists ---

        const warmupExercises = [
            { name: "90/90 Stretch", rep: "5 reps/side" },
            { name: "Pillar Bridge", rep: "20 sec hold" },
            { name: "Glute Bridge", rep: "10 reps" },
            { name: "Bent Over T's", rep: "10 reps" },
            { name: "Knee Hug", rep: "5 reps/side" },
            { name: "Reverse Lunge w/ Rotation", rep: "5 reps/side" },
            { name: "Heel-to-Glute w/ Reach", rep: "5 reps/side" },
            { name: "Squats", rep: "10 reps" },
            { name: "Drop Squat to 2-inch Run", rep: "2 reps (3s run)" },
            { name: "Drop Squat to High Knees", rep: "2 reps (3s high knees)" },
            { name: "Arm Circles", rep: "10 forward, 10 backward" },
            { name: "Neck Rolls", rep: "5 each direction" },
            { name: "Hip Circles", rep: "10 each direction" },
            { name: "Leg Swings (Front/Back)", rep: "10 reps/side" },
            { name: "Leg Swings (Side/Side)", rep: "10 reps/side" },
            { name: "World's Greatest Stretch", rep: "5 reps/side" },
            { name: "Cat-Cow", rep: "10 reps" },
            { name: "Thoracic Rotation", rep: "8 reps/side" },
            { name: "Ankle Circles", rep: "10 each direction" },
            { name: "Toy Soldiers", rep: "10 reps/side" }
        ];

        const preCardioWarmup = [
            { name: "Inverted Hamstring", rep: "5 reps/side" },
            { name: "Leg Cradle", rep: "5 reps/side" },
            { name: "Linear March", rep: "10 yards" },
            { name: "Squat Jump Countermovement", rep: "5 reps" }
        ];

        const cooldownExercises = [
            { name: "Chest Stretch", desc: "10 echo count", tip: "Clasp hands behind neck, pull elbows back" },
            { name: "Posterior Shoulder Stretch", desc: "10 echo count/side", tip: "Pull arm across body" },
            { name: "Triceps Stretch", desc: "10 echo count/side", tip: "Reach behind back, push elbow" },
            { name: "Hip Flexor Stretch", desc: "10 echo count/side", tip: "Lunge position, push hip forward" },
            { name: "Groin/Butterfly Stretch", desc: "10 echo count", tip: "Seated, soles together" },
            { name: "Modified Hurdler Stretch", desc: "10 echo count/side", tip: "Seated V-position, reach for toes" },
            { name: "Outer Hip/Low Back Stretch", desc: "10 echo count/side", tip: "Seated twist" },
            { name: "Piriformis Stretch", desc: "10 echo count/side", tip: "Lying, cross leg over thigh" },
            { name: "Low Back Stretch", desc: "10 echo count", tip: "Knees to chest" },
            { name: "Quadriceps Stretch", desc: "10 echo count/side", tip: "Standing/lying, pull heel to glute" },
            { name: "Calf Stretch", desc: "10 echo count/side", tip: "Push-up position, press heel down" }
        ];

        const db = {
            strength: {
                bodyweight: [
                    { name: "Standard Pushups", tip: "Keep core tight, elbows at 45¬∞. Feel it in chest and triceps." },
                    { name: "Wide-Arm Pushups", tip: "Hands wider than shoulders. Focus on chest stretch at bottom." },
                    { name: "Diamond Pushups", tip: "Hands form diamond under chest. Triceps focus. Modify on knees if needed." },
                    { name: "Hand-Release Pushups", tip: "Chest touches deck, lift hands, then push. Full range of motion." },
                    { name: "Decline Pushups", tip: "Feet elevated. Increases shoulder and upper chest activation." },
                    { name: "Pike Pushups", tip: "Hips high, body in inverted V. Press head toward deck. Shoulder focus." },
                    { name: "Archer Pushups", tip: "One arm extended to side, other arm does the work. Advanced unilateral strength." },
                    { name: "Hindu Pushups", tip: "Flow from downward dog to cobra. Great for flexibility and strength." },
                    { name: "Clapping Pushups", tip: "Explosive push, clap at top, soft landing. Power builder. Advanced only." },
                    { name: "Spiderman Pushups", tip: "Bring knee to elbow as you descend. Core and hip mobility." },
                    { name: "Standard Plank", tip: "Straight line ear to ankle. Don't sag hips. Engage core." },
                    { name: "Side Plank (L/R)", tip: "Stack feet or stagger. Keep hips high. Feel obliques working." },
                    { name: "Plank Shoulder Taps", tip: "In plank, tap opposite shoulder. Keep hips stable. Anti-rotation." },
                    { name: "Plank Up-Downs", tip: "Plank to pushup position and back. Control the movement." },
                    { name: "Bird Dog", tip: "Opposite arm/leg extend. Keep back flat. Core stability." },
                    { name: "Dead Bug", tip: "Press low back into deck. Move slow and controlled." },
                    { name: "Hollow Body Hold", tip: "Lower back pressed to deck, arms and legs extended. Core killer." },
                    { name: "V-Ups", tip: "Simultaneously lift legs and torso to form V. Control descent." },
                    { name: "Bicycle Crunches", tip: "Opposite elbow to knee, rotate through core. Slow and controlled." },
                    { name: "Flutter Kicks", tip: "Lower back pressed down, alternate kicking legs. Core and hip flexors." },
                    { name: "Air Squats", tip: "Weight in heels, knees track toes. Thighs parallel. Core tight." },
                    { name: "Walking Lunges", tip: "Chest up, front knee behind toes. Feel glutes and quads." },
                    { name: "Reverse Lunges", tip: "Step backward into lunge. More knee-friendly than forward lunges." },
                    { name: "Lateral Lunges", tip: "Step to side, sit back into hip. Inner thigh and glutes." },
                    { name: "Split Squats", tip: "Feet staggered, lower straight down. Keep front knee behind toes." },
                    { name: "Jump Squats", tip: "Explosive jump from squat position. Land soft, reset, repeat." },
                    { name: "Box Jumps (Step-up Alternative)", tip: "Jump onto elevated surface. Step down to protect knees." },
                    { name: "Single-Leg RDL", tip: "Balance on one leg, hinge forward. Hamstring and balance." },
                    { name: "Calf Raises", tip: "Full extension at top, slow lower. Feel the burn in calves." },
                    { name: "Wall Sit", tip: "Thighs parallel, back flat on wall. Quads should burn." },
                    { name: "Glute Bridges", tip: "Squeeze glutes at top. Don't hyperextend back." },
                    { name: "Single-Leg Glute Bridge", tip: "One leg extended, drive through planted heel. Unilateral strength." },
                    { name: "Superman Hold", tip: "Lie face down, lift arms and legs. Lower back and glutes." },
                    { name: "Prone Cobra", tip: "Face down, arms at sides, lift chest. Squeeze shoulder blades." },
                    { name: "Squat Hold", tip: "Hold bottom of squat position. Build endurance and mobility." },
                    { name: "Inchworms", tip: "Walk hands out to plank, walk feet to hands. Full body mobility." }
                ],
                bands: [
                    { name: "Band Pull-Aparts", tip: "Arms straight, squeeze shoulder blades together. Upper back." },
                    { name: "Band Bicep Curls", tip: "Elbows pinned to sides. Control the negative." },
                    { name: "Band Overhead Press", tip: "Press straight up, don't flare elbows. Core engaged." },
                    { name: "Band Squats", tip: "Band above knees pushes them out. Focus on glute engagement." },
                    { name: "Band Rows", tip: "Pull to ribcage, squeeze shoulder blades. Feel upper back." },
                    { name: "Band Tricep Extensions", tip: "Keep elbows high and stable. Squeeze at extension." },
                    { name: "Band Lateral Walks", tip: "Stay low in squat. Feel glute medius on outer hip." },
                    { name: "Band Face Pulls", tip: "Pull to face, elbows high. Rear delts and rotator cuff." },
                    { name: "Band Chest Press", tip: "Anchor behind, press forward. Chest and triceps." },
                    { name: "Band Pallof Press", tip: "Resist rotation, press away from body. Core anti-rotation." },
                    { name: "Band Good Mornings", tip: "Band on shoulders, hinge at hips. Hamstrings and glutes." },
                    { name: "Band Deadlifts", tip: "Stand on band, hinge and drive up. Hip hinge pattern." },
                    { name: "Band Monster Walks", tip: "Band above knees, walk forward with wide steps. Glute activation." },
                    { name: "Band Clamshells", tip: "Lying on side, open knees against band. Hip external rotators." },
                    { name: "Band Woodchops", tip: "Rotate through core, low to high or high to low. Obliques." }
                ],
                pullup: [
                    { name: "Pull-ups", tip: "Overhand grip. Pull chest to bar, control down. Lats and back." },
                    { name: "Chin-ups", tip: "Underhand grip. More bicep involvement. Chin over bar." },
                    { name: "Negative Pull-ups", tip: "Jump to top, lower slow (3-5 sec). Build pulling strength." },
                    { name: "Wide-Grip Pull-ups", tip: "Hands wider than shoulders. Emphasizes outer lats." },
                    { name: "Close-Grip Pull-ups", tip: "Hands close together. More mid-back and bicep focus." },
                    { name: "Commando Pull-ups", tip: "Hands staggered inline, alternate sides. Unilateral strength." },
                    { name: "L-Sit Pull-ups", tip: "Hold legs at 90¬∞ while pulling. Core and grip intensive." },
                    { name: "Hanging Leg Raises", tip: "Legs together, no swinging. Core and hip flexors." },
                    { name: "Hanging Knee Raises", tip: "Knees to chest while hanging. Easier than leg raises." },
                    { name: "Toes to Bar", tip: "Swing legs to touch bar. CrossFit standard. Requires kip." },
                    { name: "Windshield Wipers", tip: "Legs up, rotate side to side. Advanced oblique work." },
                    { name: "Dead Hangs", tip: "Relax shoulders, decompress spine. Grip strength builder." },
                    { name: "Scapular Pull-ups", tip: "Hang and retract scapula only. Builds foundation for pull-ups." },
                    { name: "Muscle-up Progressions", tip: "Pull high, transition over bar. Advanced movement." }
                ],
                kettlebells: [
                    { name: "Kettlebell Swings", tip: "Hinge at hips, not squat. Power from glutes. Arms are just hooks." },
                    { name: "Single-Arm KB Swing", tip: "One arm at a time. Trains anti-rotation. Alternate sides." },
                    { name: "Goblet Squats", tip: "Hold KB at chest. Elbows inside knees. Deep squat." },
                    { name: "KB Deadlifts", tip: "Hinge at hips, flat back. Drive through heels." },
                    { name: "KB Rows", tip: "One arm at a time. Pull to hip, squeeze lat." },
                    { name: "KB Lunges", tip: "Hold KB at chest or sides. Control the descent." },
                    { name: "KB Clean", tip: "Swing to rack position. Keep bell close to body. Wrist neutral." },
                    { name: "KB Press", tip: "From rack, press overhead. Keep core tight." },
                    { name: "KB Clean and Press", tip: "Combine clean and press in one fluid motion. Full body power." },
                    { name: "KB Turkish Get-Up", tip: "Lie to stand with KB overhead. Mobility and stability. Go slow!" },
                    { name: "KB Snatch", tip: "Swing to overhead in one motion. Power and coordination." },
                    { name: "KB Windmill", tip: "KB overhead, hinge to side. Hip and shoulder mobility." },
                    { name: "KB Halo", tip: "Circle KB around head. Shoulder mobility and stability." },
                    { name: "KB Figure 8", tip: "Pass KB around and between legs. Coordination and grip." },
                    { name: "KB Farmer Carry", tip: "Walk with KBs at sides. Grip, core, and posture." },
                    { name: "KB Rack Carry", tip: "KB in rack position, walk. Core anti-rotation." },
                    { name: "KB Sumo Deadlift", tip: "Wide stance, KB between feet. Inner thighs and glutes." },
                    { name: "KB Thruster", tip: "Squat to overhead press in one motion. Leg and shoulder power." }
                ],
                dumbbells: [
                    { name: "Dumbbell Rows", tip: "One hand on bench. Pull to hip, squeeze back." },
                    { name: "Renegade Rows", tip: "Plank position, alternate rows. Core and back." },
                    { name: "DB Overhead Press", tip: "Start at shoulders, press straight up. Don't arch back." },
                    { name: "Arnold Press", tip: "Rotate palms as you press. Full shoulder development." },
                    { name: "DB Lateral Raises", tip: "Slight bend in elbows, raise to shoulder height. Side delts." },
                    { name: "DB Front Raises", tip: "Alternating or together, raise to eye level. Front delts." },
                    { name: "DB Rear Delt Flyes", tip: "Bent over, raise arms to sides. Rear delts and upper back." },
                    { name: "DB Lunges", tip: "DBs at sides. Step forward, control down and up." },
                    { name: "DB Romanian Deadlift", tip: "DBs in front, hinge at hips. Hamstrings and glutes." },
                    { name: "DB Curls", tip: "No swinging. Elbows pinned. Full range of motion." },
                    { name: "Hammer Curls", tip: "Palms facing in. Targets brachialis and forearms." },
                    { name: "Concentration Curls", tip: "Seated, elbow on thigh. Isolate the bicep." },
                    { name: "DB Tricep Extensions", tip: "One or both hands overhead. Lower behind head, extend." },
                    { name: "DB Skull Crushers", tip: "Lying down, lower to forehead. Tricep isolation." },
                    { name: "DB Kickbacks", tip: "Bent over, extend arm back. Squeeze tricep at top." },
                    { name: "DB Thrusters", tip: "Squat to press in one motion. Full body power." },
                    { name: "DB Farmer Carry", tip: "Walk with DBs at sides. Grip and core stability." },
                    { name: "DB Goblet Squat", tip: "Hold one DB at chest, squat deep. Leg and core." },
                    { name: "DB Step-Ups", tip: "DBs at sides, step onto box. Unilateral leg strength." },
                    { name: "DB Pullover", tip: "Lying on bench, lower DB behind head. Lats and chest." },
                    { name: "DB Shrugs", tip: "Heavy DBs, shrug shoulders to ears. Upper traps." }
                ],
                barbell: [
                    { name: "Barbell Deadlift", tip: "Hinge at hips, flat back. Bar close to body. Drive through heels." },
                    { name: "Barbell Back Squat", tip: "Bar on upper back, not neck. Depth to parallel or below." },
                    { name: "Barbell Front Squat", tip: "Elbows high, bar on shoulders. Keep torso upright." },
                    { name: "Barbell Overhead Press", tip: "Start at shoulders, press straight up. Squeeze glutes for stability." },
                    { name: "Barbell Bent Over Row", tip: "Hinge forward 45¬∞, pull to belly button. Squeeze back." },
                    { name: "Barbell RDL", tip: "Slight knee bend, hinge at hips. Feel hamstrings stretch." },
                    { name: "Barbell Lunges", tip: "Bar on back, step forward. Keep torso upright." },
                    { name: "Barbell Floor Press", tip: "Lying on floor, press up. Great for triceps and lockout strength." },
                    { name: "Barbell Hip Thrust", tip: "Upper back on bench, bar on hips. Squeeze glutes at top." },
                    { name: "Barbell Good Mornings", tip: "Bar on back, hinge forward. Feel hamstrings and low back." }
                ],
                flatBench: [
                    { name: "Dumbbell Bench Press", tip: "DBs at chest level, press up and together. Control the negative." },
                    { name: "Dumbbell Flyes", tip: "Slight elbow bend, lower wide. Feel chest stretch." },
                    { name: "Bench Step-Ups", tip: "Drive through front heel. Alternate legs." },
                    { name: "Bench Hip Thrusts", tip: "Upper back on bench, drive hips up. Squeeze glutes." },
                    { name: "Incline Push-ups", tip: "Hands on bench, easier angle. Good for beginners." },
                    { name: "Bench Tricep Dips", tip: "Hands on edge, lower body. Elbows back, not out." },
                    { name: "Single-Leg Bench Squats", tip: "One foot on bench behind, squat on front leg. Bulgarian split squat." }
                ],
                adjBench: [
                    { name: "Incline Dumbbell Press", tip: "Bench at 30-45¬∞. Press up from upper chest." },
                    { name: "Incline Dumbbell Flyes", tip: "Bench at 30¬∞, arms wide. Upper chest focus." },
                    { name: "Seated Shoulder Press", tip: "Bench upright, press dumbbells overhead." },
                    { name: "Incline Dumbbell Rows", tip: "Chest on incline bench, pull DBs up. Upper back focus." },
                    { name: "Decline Push-ups", tip: "Feet on bench. Increases difficulty and shoulder engagement." },
                    { name: "Seated Incline Curls", tip: "Bench at 45¬∞, curl with stretch at bottom." },
                    { name: "Prone Y-T-W Raises", tip: "Lie face down on incline, raise arms in Y, T, W patterns. Shoulder health." }
                ],
                sled: [
                    { name: "Sled Push (High Handles)", tip: "Arms extended, drive with legs. Stay low and powerful." },
                    { name: "Sled Push (Low Handles)", tip: "Hands low, chest down. More quad and glute drive." },
                    { name: "Sled Pull (Backward)", tip: "Face sled, pull toward you walking backward. Quads burn." },
                    { name: "Sled Drag (Forward)", tip: "Strap around waist, walk forward. Great for conditioning." },
                    { name: "Sled Row", tip: "Face sled, row handle to chest. Upper back and biceps." },
                    { name: "Sled Sprint", tip: "Explosive push for 20-40 yards. Max effort." }
                ]
            },
            lowImpact: {
                strength: {
                    bodyweight: [
                        { name: "Standard Pushups", tip: "Keep core tight, elbows at 45¬∞. Modify on knees if needed." },
                        { name: "Incline Push-ups", tip: "Hands on bench or wall. Easier angle for shoulder comfort." },
                        { name: "Standard Plank", tip: "Straight line ear to ankle. Breathe steady." },
                        { name: "Side Plank (L/R)", tip: "Stack feet or stagger. Keep hips high." },
                        { name: "Bird Dog", tip: "Opposite arm/leg extend. Keep back flat." },
                        { name: "Dead Bug", tip: "Press low back into deck. Slow, controlled reps." },
                        { name: "Air Squats", tip: "Controlled depth. Sit back into heels." },
                        { name: "Wall Sit", tip: "Thighs parallel, back flat on wall. Hold steady." },
                        { name: "Glute Bridges", tip: "Squeeze glutes at top. No hyperextension." },
                        { name: "Calf Raises", tip: "Slow up/down. Use support if needed." }
                    ],
                    bands: [
                        { name: "Band Pull-Aparts", tip: "Arms straight, squeeze shoulder blades together." },
                        { name: "Band Bicep Curls", tip: "Elbows pinned to sides. Control the negative." },
                        { name: "Band Overhead Press", tip: "Press straight up, ribs down." },
                        { name: "Band Rows", tip: "Pull to ribcage, squeeze upper back." },
                        { name: "Band Tricep Extensions", tip: "Keep elbows high and steady." },
                        { name: "Band Lateral Walks", tip: "Stay low, short steps. Feel glute medius." }
                    ],
                    kettlebells: [
                        { name: "Goblet Squats", tip: "Hold KB at chest. Stay controlled." },
                        { name: "KB Deadlifts", tip: "Hinge at hips, flat back." },
                        { name: "KB Rows", tip: "One arm at a time. Pull to hip." }
                    ],
                    dumbbells: [
                        { name: "Dumbbell Rows", tip: "Support on bench. Pull to hip, squeeze back." },
                        { name: "DB Overhead Press", tip: "Press straight up. Keep core engaged." },
                        { name: "DB Curls", tip: "No swinging. Full range of motion." },
                        { name: "DB Tricep Extensions", tip: "Control the lowering phase." }
                    ],
                    flatBench: [
                        { name: "Dumbbell Bench Press", tip: "Control the negative. Keep shoulders packed." },
                        { name: "Bench Hip Thrusts", tip: "Drive through heels, squeeze glutes." },
                        { name: "Incline Push-ups", tip: "Hands on bench, steady pace." }
                    ],
                    adjBench: [
                        { name: "Incline Dumbbell Press", tip: "Bench at 30-45¬∞. Smooth tempo." },
                        { name: "Incline Dumbbell Rows", tip: "Chest on bench, pull DBs up." },
                        { name: "Seated Shoulder Press", tip: "Upright bench, steady reps." },
                        { name: "Seated Incline Curls", tip: "Slow reps, full extension." },
                        { name: "Prone Y-T-W Raises", tip: "Light weight. Focus on control." }
                    ],
                    sled: [
                        { name: "Sled Push (High Handles)", tip: "Smooth drive, steady pace." },
                        { name: "Sled Pull (Backward)", tip: "Short steps, stay tall." },
                        { name: "Sled Drag (Forward)", tip: "Walk forward, keep pace even." }
                    ]
                },
                cardio: {
                    indoor: [
                        { name: "March in Place", tip: "Tall posture, drive arms. Light impact.", reps: "60-90 seconds" },
                        { name: "Step Touches", tip: "Side steps, keep rhythm. Add arm swings.", reps: "60 seconds" },
                        { name: "Low-Impact Jacks", tip: "Step out instead of jump. Keep heart rate up.", reps: "30-45 seconds" },
                        { name: "Shadow Boxing", tip: "Light footwork, punch combos. Keep knees soft.", reps: "45-60 seconds" },
                        { name: "Lateral Shuffles", tip: "Stay low, quick side-to-side movement.", reps: "30-45 seconds" },
                        { name: "Jog (Gym Laps)", tip: "Easy pace. Stay light on feet.", reps: "2-4 laps", isFinisher: true }
                    ],
                    outdoor: [
                        { name: "Brisk Walk Intervals", tip: "Power walk, pump arms. 1 min brisk, 1 min easy.", reps: "6-8 rounds" },
                        { name: "Light Jog/Walk", tip: "Conversational pace, avoid pounding.", reps: "8-12 min", isFinisher: true }
                    ],
                    assaultBike: [
                        { name: "Assault Bike Steady State", tip: "Moderate pace, keep RPM consistent.", reps: "3-5 min", isFinisher: true },
                        { name: "Assault Bike Intervals", tip: "15-30s on, 45-60s easy. Stay smooth.", reps: "6-8 rounds" }
                    ],
                    rower: [
                        { name: "Rowing Steady State (2000m)", tip: "Moderate pace 18-22 strokes/min.", reps: "2000m", isFinisher: true },
                        { name: "Rowing Intervals (500m)", tip: "Moderate effort, focus on form.", reps: "500m x 4-5 intervals" }
                    ],
                    cycle: [
                        { name: "Team Bike Ride", tip: "Easy-moderate pace to stay with the group.", reps: "10-15 min", isFinisher: true },
                        { name: "Cycling Steady State", tip: "Moderate resistance, consistent pace.", reps: "5-10 min", isFinisher: true },
                        { name: "Cycling Intervals", tip: "1 min moderate, 1 min easy. Keep cadence smooth.", reps: "6-8 rounds" }
                    ],
                    bicycle: [
                        { name: "Team Bike Ride", tip: "Easy-moderate pace to stay with the group.", reps: "10-15 min", isFinisher: true },
                        { name: "Bike Ride Intervals", tip: "2 min steady, 1 min easy spin. Stay smooth.", reps: "6-8 rounds" }
                    ],
                    treadmill: [
                        { name: "Incline Walk", tip: "10-15% incline, moderate pace.", reps: "5-10 min", isFinisher: true },
                        { name: "Treadmill Intervals", tip: "1 min jog, 1 min walk. Adjust speed to comfort.", reps: "6-8 rounds" }
                    ],
                    swimming: [
                        { name: "Easy Freestyle Laps", tip: "Relaxed pace, focus on form. Low impact on joints.", reps: "300-500m", isFinisher: true },
                        { name: "Breaststroke Laps", tip: "Gentle stroke, easy on shoulders. Good recovery swim.", reps: "200-400m", isFinisher: true },
                        { name: "Backstroke Laps", tip: "Shoulder-friendly, relaxed pace. Great for recovery.", reps: "200-300m" },
                        { name: "Pool Walking/Jogging", tip: "Walk or jog in shallow end. Zero impact cardio.", reps: "10-15 min", isFinisher: true },
                        { name: "Gentle Kick Laps", tip: "Easy flutter kick with board. Light leg work.", reps: "200-300m" },
                        { name: "Treading Water (Relaxed)", tip: "Easy pace treading. Use eggbeater or scissor kick.", reps: "3-5 min" }
                    ]
                }
            },
            cardio: {
                indoor: [
                    { name: "High Knees (March/Run)", tip: "Drive knees up, pump arms. Keep core engaged.", reps: "30-45 seconds" },
                    { name: "Fast Feet Drill", tip: "Quick, light steps. Stay on balls of feet.", reps: "30 seconds" },
                    { name: "Seal Jacks", tip: "Arms out front instead of overhead. Low impact option.", reps: "20-30 reps" },
                    { name: "Mountain Climbers (Controlled)", tip: "Hips level with shoulders. Alternate knees to chest.", reps: "20-30 reps" },
                    { name: "Skater Jumps", tip: "Lateral jump, land soft. Touch opposite hand to foot.", reps: "10-15 per side" },
                    { name: "Burpees (No Push-up)", tip: "Squat, jump back to plank, hop forward, stand. Modify as needed.", reps: "10-15 reps" },
                    { name: "Lateral Shuffles", tip: "Stay low, quick side-to-side movement. 10 yards each direction.", reps: "30-45 seconds" },
                    { name: "Jog (Gym Laps)", tip: "1 lap around gym/basketball court. Light on feet, steady pace.", reps: "2-4 laps", isFinisher: true }
                ],
                outdoor: [
                    { name: "Sprint Intervals (100m)", tip: "Max effort sprint, walk 100m recovery. Repeat.", reps: "4-6 sprints" },
                    { name: "Shuttle Runs (25yd)", tip: "Touch line at each end. Explode out of turns.", reps: "4-6 shuttles" },
                    { name: "Hill Repeats", tip: "Sprint up, walk down. Drive knees on incline.", reps: "4-6 repeats" },
                    { name: "Linear Skips", tip: "Exaggerated skip, drive knee high. 25-50 yards.", reps: "2-4 lengths" },
                    { name: "Track Run (Steady State)", tip: "1 lap around the track at consistent pace. Breathe rhythmically.", reps: "1-2 laps", isFinisher: true },
                    { name: "400m Run", tip: "1 lap around the track at moderate pace. Control breathing.", reps: "1 lap", isFinisher: true },
                    { name: "Warrior Run (Last Runner Up)", tip: "Jog in formation, last person sprints to front. Repeat.", reps: "5-10 min", isFinisher: true }
                ],
                jumprope: [
                    { name: "Jump Rope (2 min)", tip: "Light bounces, wrists turn rope. Stay relaxed.", reps: "2 min" },
                    { name: "Jump Rope High Knees", tip: "Alternate high knees while jumping. Cardio + core.", reps: "1 min" },
                    { name: "Double Unders", tip: "Higher jump, faster wrist spin. Advanced skill.", reps: "20-30 reps" },
                    { name: "Jump Rope Intervals", tip: "30s fast, 30s easy. Build endurance.", reps: "3-4 rounds" }
                ],
                assaultBike: [
                    { name: "Assault Bike Intervals", tip: "15-30s max effort with full recovery. Push and pull with arms.", reps: "15-30s on / 45-60s rest x 6-8" },
                    { name: "Assault Bike Sprints", tip: "All-out effort, take full rest between. It's a killer!", reps: "20-30s sprint / 60s rest x 5-6" },
                    { name: "Assault Bike Steady State", tip: "Moderate pace, keep RPM consistent.", reps: "3-5 min", isFinisher: true },
                    { name: "Assault Bike Tabata", tip: "Maximum intensity. Take extra rest between sets if needed.", reps: "20s on / 10s off x 8 (rest 2 min, repeat)" },
                    { name: "Assault Bike Calorie Sprints", tip: "Sprint to hit target calories, rest fully between rounds.", reps: "10 cal sprint / 60s rest x 5-6 rounds" }
                ],
                rower: [
                    { name: "Rowing Intervals (500m)", tip: "500m hard, 1 min rest. Drive with legs first.", reps: "500m x 4-6 intervals" },
                    { name: "Rowing Sprints (250m)", tip: "All-out effort for 250m, rest 1 min between.", reps: "250m x 5-6 sprints" },
                    { name: "Rowing Steady State (2000m)", tip: "Moderate pace 18-22 strokes/min. Focus on form.", reps: "2000m", isFinisher: true },
                    { name: "Rowing Pyramid", tip: "250m-500m-750m-500m-250m. Control pace on longer pieces.", reps: "2250m total" },
                    { name: "Rowing 1000m", tip: "Build pace throughout. Sprint last 200m.", reps: "1000m" }
                ],
                cycle: [
                    { name: "Cycling Intervals", tip: "1 min high resistance, 1 min low. Maintain cadence.", reps: "6-8 rounds" },
                    { name: "Cycling Sprints", tip: "30s max speed, 30s easy. Seated or standing.", reps: "6-8 sprints" },
                    { name: "Cycling Steady State", tip: "Moderate resistance, consistent pace. Good recovery.", reps: "5-10 min", isFinisher: true },
                    { name: "Cycling Hills", tip: "Increase resistance, stand and climb. 1 min on, 1 min off.", reps: "5-6 hills" },
                    { name: "Cycling Tabata", tip: "20s sprint, 10s rest x 8. High cadence.", reps: "4 min" }
                ],
                bicycle: [
                    { name: "Team Bike Ride", tip: "Easy-moderate pace to stay with the group.", reps: "10-15 min", isFinisher: true },
                    { name: "Bike Ride Intervals", tip: "2 min steady, 1 min easy spin. Stay smooth.", reps: "6-8 rounds" },
                    { name: "Bike Hill Climbs", tip: "Find a short hill, climb strong, easy coast down.", reps: "4-6 climbs" }
                ],
                treadmill: [
                    { name: "Treadmill Intervals", tip: "1 min sprint, 1 min walk. Adjust speed for ability.", reps: "6-8 rounds" },
                    { name: "Treadmill Sprints", tip: "30s at 80-90% effort, 30s rest. Hold rails to hop on/off.", reps: "6-8 sprints" },
                    { name: "Incline Walk", tip: "10-15% incline, moderate pace. Great for glutes and calves.", reps: "5-10 min", isFinisher: true },
                    { name: "Treadmill Run", tip: "Steady pace jog. Focus on breathing rhythm.", reps: "5-10 min", isFinisher: true },
                    { name: "Incline Sprints", tip: "5-8% incline, sprint 20s, rest 40s. Power builder.", reps: "5-6 sprints" }
                ],
                swimming: [
                    { name: "Freestyle Laps", tip: "Steady pace freestyle. Focus on smooth stroke and bilateral breathing.", reps: "500m steady", isFinisher: true },
                    { name: "Freestyle Intervals", tip: "50m sprint, 20s rest. Maintain form at speed.", reps: "8-10 x 50m" },
                    { name: "Freestyle Sprints", tip: "25m all-out effort, full recovery between.", reps: "6-8 x 25m" },
                    { name: "Breaststroke Laps", tip: "Steady breaststroke. Good for active recovery or variety.", reps: "200-400m" },
                    { name: "Backstroke Laps", tip: "Focus on hip rotation and steady kick. Shoulder-friendly option.", reps: "200-400m" },
                    { name: "Mixed Stroke Pyramid", tip: "100m free, 75m breast, 50m back, 25m fly (or free). Build up and down.", reps: "500m total" },
                    { name: "Kick Board Laps", tip: "Flutter kick with board. Builds leg endurance and kick power.", reps: "200-400m" },
                    { name: "Pull Buoy Laps", tip: "Upper body focus. Keep legs still, power from arms.", reps: "200-400m" },
                    { name: "Underwater Swim", tip: "Breath hold and streamline glide. Build lung capacity. Safety first!", reps: "4-6 x 15m" },
                    { name: "Treading Water", tip: "Vertical in deep end. Hands out of water for challenge.", reps: "2-5 min continuous" },
                    { name: "Combat Sidestroke (CSS)", tip: "Navy swim standard. Head low, efficient stroke. Practice breathing.", reps: "500m steady", isFinisher: true },
                    { name: "CSS Intervals", tip: "100m CSS at goal pace, 30s rest. Build speed and efficiency.", reps: "5-8 x 100m" },
                    { name: "Pool Running", tip: "Deep water running with flotation belt. Zero impact cardio.", reps: "10-15 min" },
                    { name: "Buddy Tow Drill", tip: "Tow partner across pool. Rescue swim practice. Switch roles.", reps: "4-6 lengths" }
                ]
            },
            yoga: [
                { name: "Cat-Cow Stretch", duration: "30-45 seconds", tip: "Flow between arching and rounding back. Sync with breath." },
                { name: "Child's Pose", duration: "30-60 seconds", tip: "Knees wide, arms extended. Rest forehead on mat." },
                { name: "Downward Dog", duration: "30-45 seconds", tip: "Hips high, heels reaching down. Press hands into mat." },
                { name: "Forward Fold", duration: "30-45 seconds", tip: "Let head hang heavy. Bend knees if hamstrings tight." },
                { name: "Low Lunge", duration: "30 seconds/side", tip: "Back knee down, hips sink forward. Hip flexor stretch." },
                { name: "Pigeon Pose", duration: "45-60 seconds/side", tip: "Front shin across mat. Deep hip opener." },
                { name: "Seated Twist", duration: "30 seconds/side", tip: "Tall spine, twist from core. Look over back shoulder." },
                { name: "Thread the Needle", duration: "30-45 seconds/side", tip: "On all fours, reach arm under body. Shoulder stretch." },
                { name: "Supine Twist", duration: "30-45 seconds/side", tip: "Lying on back, knees to one side. Arms out in T." },
                { name: "Cobra Pose", duration: "20-30 seconds", tip: "Gentle backbend, shoulders down. Don't strain neck." },
                { name: "Butterfly Stretch", duration: "30-60 seconds", tip: "Soles of feet together, knees drop. Inner thigh stretch." },
                { name: "Happy Baby", duration: "30-45 seconds", tip: "Grab outside of feet, rock gently. Low back release." },
                { name: "Figure Four Stretch", duration: "30-45 seconds/side", tip: "Ankle on opposite knee, pull thigh in. Piriformis stretch." },
                { name: "Supine Hamstring Stretch", duration: "30-45 seconds/side", tip: "Leg straight up, use strap or hands. Keep other leg flat." },
                { name: "Neck Rolls", duration: "30 seconds each direction", tip: "Slow circles, release tension. Don't force range." },
                { name: "Shoulder Rolls", duration: "30 seconds", tip: "Roll forward then backward. Release upper body tension." },
                { name: "Wrist Circles", duration: "20-30 seconds each direction", tip: "Circle wrists both ways. Good for desk workers." },
                { name: "Standing Side Stretch", duration: "20-30 seconds/side", tip: "Reach arm overhead, lean to opposite side. Stretch obliques." },
                { name: "Warrior I", duration: "30 seconds/side", tip: "Front knee bent, back leg straight. Arms reach up." },
                { name: "Warrior II", duration: "30 seconds/side", tip: "Arms parallel to ground, gaze over front hand. Strong legs." },
                { name: "Triangle Pose", duration: "30 seconds/side", tip: "Front leg straight, reach down and up. Open chest." },
                { name: "Tree Pose", duration: "30 seconds/side", tip: "Foot on inner thigh or calf. Balance practice." },
                { name: "Corpse Pose (Savasana)", duration: "2-3 minutes", tip: "Final relaxation. Lie completely still, focus on breath." }
            ],
            funday: {
                outdoor: [
                    // Equipment-based games (with fitness penalties)
                    { name: "Kickball with PT", tip: "Standard baseball rules. FITNESS: Outs do 5 4-count pushups. Scored-on team does 10 4-count exercise chosen by scoring team.", requires: "kickball" },
                    { name: "Ultimate Frisbee", tip: "Score by catching in end zone. FITNESS: Scored-on team does 10 4-count burpees. Turnover = 5 4-count mountain climbers.", requires: "frisbee", link: "https://www.youtube.com/watch?v=LPd-XdI5tuk" },
                    { name: "Flag Football", tip: "Flag pull or two-hand touch only (no tackling). FITNESS: Scored-on team does 10 4-count exercise picked by scoring team. Turnover = 5 4-count pushups.", requires: "football" },
                    { name: "Soccer", tip: "Full field or small-sided. FITNESS: Scored-on team does 10 4-count squats. Penalty for offsides = 5 4-count situps.", requires: "soccer" },
                    { name: "Softball with Fitness", tip: "Slow pitch. FITNESS: Outs do 5 4-count pushups before returning to dugout. Scored-on team does 10 4-count exercise.", requires: "baseball" },
                    { name: "Capture the Flag", tip: "Two teams, two territories. FITNESS: Captured players do 10 4-count burpees in 'jail', freed by teammates. Great cardio!", requires: "flagSet" },
                    { name: "Tug of War", tip: "Equal teams by weight. FITNESS: Losing team does 15 4-count exercise chosen by winners. Best 2 of 3 rounds.", requires: "tugRope" },
                    { name: "Obstacle Course Time Trial", tip: "Set up PT stations with cones. FITNESS: Team with slowest time does 10 extra 4-count burpees. All exercises are 4-count.", requires: "cones" },
                    { name: "Speedball", tip: "Hybrid sport - kick or throw to score. FITNESS: Scored-on team does 10 4-count exercise chosen by scoring team. Fast-paced!", requires: "soccer", link: "https://www.youtube.com/watch?v=yP3VvqYYlGI" },
                    { name: "Spikeball (Roundnet)", tip: "2v2 teams, 3 touches to return. FITNESS: Losing team each game does 10 4-count pushups. Play best of 5 to 21 points.", requires: "spikeball", link: "https://www.youtube.com/watch?v=FRmjRZpHQH8" },
                    { name: "Kan Jam", tip: "Frisbee to can, partner deflects. FITNESS: Losing team does 10 4-count exercise. First to 21 wins!", requires: "frisbee" },
                    // No-equipment games (with facility preferences and fitness penalties)
                    { name: "British Bulldog", tip: "Players run across field. Bulldogs tag with two-hand touch (no tackling). FITNESS: Tagged players do 10 4-count pushups before becoming bulldogs.", noEquipment: true, preferredFacility: "openField", link: "https://www.youtube.com/watch?v=7vtfR6EqPLE" },
                    { name: "Manhunt", tip: "Hide and seek meets tag. FITNESS: Tagged players do 10 4-count burpees before becoming hunters. Keeps fitness high!", noEquipment: true, preferredFacility: "openField" },
                    { name: "Tag Variations (Freeze Tag, Tunnel Tag)", tip: "Classic tag games. FITNESS: Tagged players do 10 4-count mountain climbers to unfreeze OR wait for teammate crawl-through.", noEquipment: true },
                    { name: "Red Light Green Light", tip: "Leader calls movements. FITNESS: Caught moving = 5 4-count pushups at start line, then rejoin.", noEquipment: true },
                    { name: "Blob Tag", tip: "Tagged players join 'blob'. FITNESS: When blob catches 3+ people, everyone does 10 4-count jumping jacks, then restart.", noEquipment: true, preferredFacility: "openField" },
                    { name: "Relay Races with PT", tip: "Sprint relays with PT stops. FITNESS: Each leg = sprint 50m ‚Üí 10 4-count exercise ‚Üí sprint back. Rotate: pushups, situps, squats, burpees.", noEquipment: true, preferredFacility: "track" },
                    { name: "Track Sprints Competition", tip: "400m relay, 800m time trials. FITNESS: Losing team does 10 4-count exercise chosen by winners after each round.", noEquipment: true, preferredFacility: "track" },
                    { name: "Mile Challenge", tip: "Team mile runs with PT penalties. FITNESS: Last team to finish does 15 4-count exercise chosen by winners.", noEquipment: true, preferredFacility: "track" },
                    { name: "Fartlek Training Game", tip: "Swedish speed play with PT stations. FITNESS: After each sprint interval, group does 10 4-count exercise (rotating: burpees, mountain climbers, squat thrusts).", noEquipment: true, preferredFacility: "track" },
                    { name: "Sharks and Minnows", tip: "Minnows sprint across while sharks tag. FITNESS: Tagged minnows do 10 4-count pushups before becoming sharks. Constant movement!", noEquipment: true, preferredFacility: "openField" },
                    { name: "Capture the Territory", tip: "Mark zones, tag to score. FITNESS: Scored-on team does 10 4-count exercise chosen by scoring team. Play to 5 points.", noEquipment: true, preferredFacility: "openField" },
                    { name: "Ultimate (No Disc)", tip: "Pass invisible 'disc' with hand touches. FITNESS: Scoring team picks exercise, defending team does 10 4-count reps. Play to 7.", noEquipment: true, preferredFacility: "openField" },
                    { name: "Baseball Diamond Sprints with PT", tip: "Race around bases with PT stations. FITNESS: Each base = 5 4-count exercise (1st: pushups, 2nd: situps, 3rd: squats, home: burpees).", noEquipment: true, preferredFacility: "baseballField" },
                    { name: "Pickle (No Ball)", tip: "Rundown drill between bases. FITNESS: Tagged runners do 10 4-count mountain climbers. Rotate taggers every 5 tags.", noEquipment: true, preferredFacility: "baseballField" },
                    { name: "Simon Says PT", tip: "Leader calls exercises with 'Simon Says'. FITNESS: Caught without 'Simon Says' = 5 4-count penalty. All exercises 4-count!", noEquipment: true },
                    { name: "Partner Wheelbarrow Races", tip: "One holds ankles, partner walks on hands. FITNESS: Losing teams do 10 4-count pushups. Switch partners, race again!", noEquipment: true },
                    { name: "Steal the Bacon with PT", tip: "Race to grab object. FITNESS: Tagged players do 10 4-count exercise. Winning team picks next exercise. First to 10 points.", noEquipment: true },
                    { name: "Team Elimination Sprint", tip: "Sprint to center line. FITNESS: Last team across loses one player AND does 10 4-count burpees. Eliminated players cheer!", noEquipment: true },
                    { name: "Fitness Bingo", tip: "Complete exercises in bingo pattern. FITNESS: All exercises are 4-count. First team to complete row wins. Losers do 20 4-count burpees!", noEquipment: true },
                    { name: "PT Station Circuit Race", tip: "8-10 stations, all 4-count exercises (10 reps each). Teams race through circuit. FITNESS: Losing team repeats final 2 stations!", noEquipment: true }
                ],
                indoor: [
                    // Equipment-based games
                    { name: "Basketball", tip: "Full court or half court games. Rotate teams every 10-15 min.", requires: "basketball" },
                    { name: "Basketball Knockout", tip: "Players shoot from free throw. Miss and you're eliminated by player behind you. Last standing wins.", requires: "basketball" },
                    { name: "Around the World", tip: "Basketball shooting game. Make shot from each spot around arc to advance. Miss twice = restart.", requires: "basketball" },
                    { name: "Volleyball", tip: "Rally scoring to 25. Rotate servers. Modify net height as needed.", requires: "volleyball" },
                    { name: "Dodgeball Variations", tip: "Doctor Dodgeball: One 'doctor' per team can revive teammates. Or Jailbreak: Catch ball to free teammates.", requires: "dodgeball" },
                    { name: "Dodgeball", tip: "Soft balls only. Clear boundaries. Eliminated players do exercises on sideline.", requires: "dodgeball" },
                    { name: "Bombardment", tip: "Dodgeball meets bowling. Hit cones behind opponent's line to win. 3 balls per side.", requires: "dodgeball", link: "https://www.youtube.com/watch?v=JQbqfK5Z8_A" },
                    { name: "Floor Hockey", tip: "Plastic sticks and puck. No high sticking. Rotate goalies.", requires: "hockey" },
                    // No-equipment games (with facility preferences)
                    { name: "Octopus Tag", tip: "Tagger in middle can only pivot on one foot. Others run past. Tagged join as octopi.", noEquipment: true },
                    { name: "Fitness Tag", tip: "Tagged players do 10 pushups to get back in. Constant movement and exercise.", noEquipment: true },
                    { name: "Musical Fitness", tip: "Music stops, everyone does called exercise. Fun and unpredictable.", noEquipment: true },
                    { name: "Partner Exercises Circuit", tip: "Partner-based exercises: wheelbarrow, partner sit-ups, plank high-fives.", noEquipment: true },
                    { name: "Mirror Drill", tip: "Partners face each other. One leads movements, other mirrors. Switch every 2 min.", noEquipment: true },
                    { name: "Line Drills", tip: "Use court lines for sprints, shuffles, carioca, high knees between lines.", noEquipment: true, preferredFacility: "basketballCourt" },
                    { name: "Basketball Court Suicides", tip: "Sprint to each line and back. Baseline to free throw, half court, far free throw, baseline.", noEquipment: true, preferredFacility: "basketballCourt" },
                    { name: "Full Court Tag", tip: "Use basketball court boundaries. Can't cross out of bounds. Constant direction changes!", noEquipment: true, preferredFacility: "basketballCourt" },
                    { name: "Volleyball Court Relay", tip: "Teams line up on each side. Sprint under net, tag teammate. Fast rotation relay.", noEquipment: true, preferredFacility: "volleyballCourt" },
                    { name: "Ship Captain Crew", tip: "Leader calls commands (Port/Starboard/Captain's Coming). Last to respond is out.", noEquipment: true },
                    { name: "Stuck in the Mud", tip: "Tagged players spread legs (stuck in mud). Freed when teammate crawls through. Fast-paced!", noEquipment: true },
                    { name: "Chain Tag", tip: "Tagged players join hands with tagger. Chain grows. Only end players can tag.", noEquipment: true },
                    { name: "Fitness Dice", tip: "Giant foam dice with exercises on each side. Roll dice, whole team does that exercise.", noEquipment: true },
                    { name: "Ninja", tip: "Circle game. Take turns trying to 'chop' others' hands. Stay frozen until your turn. Strategy game!", noEquipment: true, link: "https://www.youtube.com/watch?v=Cq5WhjJpixk" },
                    { name: "Human Knot", tip: "Circle up, grab random hands across circle. Untangle without letting go. Team building!", noEquipment: true },
                    { name: "Follow the Leader PT", tip: "Leader calls movements (burpees, jumping jacks, etc). Everyone follows. Rotate leaders every 3 min.", noEquipment: true }
                ]
            }
        };

        // --- Equipment Toggle Logic ---

        function toggleNone() {
            const noneBox = document.getElementById('equipNone');
            const equipItems = document.querySelectorAll('.equip-item');
            const noneLabel = noneBox.closest('.equip-checkbox');

            if (noneBox.checked) {
                equipItems.forEach(item => {
                    item.checked = false;
                    item.closest('.equip-checkbox').classList.remove('none-selected');
                });
                noneLabel.classList.add('none-selected');
            }
        }

        function equipChanged() {
            const noneBox = document.getElementById('equipNone');
            const noneLabel = noneBox.closest('.equip-checkbox');
            const equipItems = document.querySelectorAll('.equip-item');
            const anyChecked = Array.from(equipItems).some(item => item.checked);

            if (anyChecked) {
                noneBox.checked = false;
                noneLabel.classList.remove('none-selected');
            } else {
                noneBox.checked = true;
                noneLabel.classList.add('none-selected');
            }
        }

        // --- Fun Day Equipment Toggle Logic ---

        function toggleFundayNone() {
            const noneBox = document.getElementById('fundayNoEquip');
            const fundayEquipItems = document.querySelectorAll('.funday-equip');
            const noneLabel = document.getElementById('fundayNoneLabel');
            const facilitiesSection = document.getElementById('fundayFacilitiesSection');

            if (noneBox.checked) {
                // Uncheck only equipment items, not facilities
                fundayEquipItems.forEach(item => {
                    item.checked = false;
                    item.closest('.equip-checkbox').classList.add('disabled');
                });
                noneLabel.classList.add('none-selected');

                // Keep facilities section enabled - they can influence no-equipment game selection
                const facilityCheckboxes = document.querySelectorAll('.funday-facility');
                facilityCheckboxes.forEach(item => {
                    item.closest('.equip-checkbox').classList.remove('disabled');
                });

                // Only dim the equipment section
                const equipmentGrids = facilitiesSection.querySelectorAll('.equip-grid');
                if (equipmentGrids.length > 1) {
                    equipmentGrids[1].style.opacity = '0.4';
                    equipmentGrids[1].style.pointerEvents = 'none';
                }
            } else {
                fundayEquipItems.forEach(item => {
                    item.closest('.equip-checkbox').classList.remove('disabled');
                });
                noneLabel.classList.remove('none-selected');

                const equipmentGrids = facilitiesSection.querySelectorAll('.equip-grid');
                if (equipmentGrids.length > 1) {
                    equipmentGrids[1].style.opacity = '1';
                    equipmentGrids[1].style.pointerEvents = 'auto';
                }
            }
            savePTGeneratorPreferences();
        }

        function fundayEquipChanged() {
            const noneBox = document.getElementById('fundayNoEquip');
            const noneLabel = document.getElementById('fundayNoneLabel');
            const fundayEquipItems = document.querySelectorAll('.funday-equip');
            const facilitiesSection = document.getElementById('fundayFacilitiesSection');
            const anyEquipmentChecked = Array.from(fundayEquipItems).some(item => item.checked);

            if (anyEquipmentChecked) {
                // Equipment selected, disable "No Equipment" mode
                noneBox.checked = false;
                noneLabel.classList.remove('none-selected');

                const equipmentGrids = facilitiesSection.querySelectorAll('.equip-grid');
                if (equipmentGrids.length > 1) {
                    equipmentGrids[1].style.opacity = '1';
                    equipmentGrids[1].style.pointerEvents = 'auto';
                }
            } else {
                // No equipment selected - check if we should enable "No Equipment" mode
                const facilityItems = document.querySelectorAll('.funday-facility');
                const anyFacilityChecked = Array.from(facilityItems).some(item => item.checked);

                // Only enable "No Equipment" mode if no facilities are selected either
                if (!anyFacilityChecked) {
                    noneBox.checked = true;
                    noneLabel.classList.add('none-selected');

                    const equipmentGrids = facilitiesSection.querySelectorAll('.equip-grid');
                    if (equipmentGrids.length > 1) {
                        equipmentGrids[1].style.opacity = '0.4';
                        equipmentGrids[1].style.pointerEvents = 'none';
                    }
                }
            }
            savePTGeneratorPreferences();
        }

        function getSelectedEquipment() {
            return {
                bands: document.getElementById('equipBands').checked,
                pullup: document.getElementById('equipPullup').checked,
                kettlebells: document.getElementById('equipKettlebells').checked,
                dumbbells: document.getElementById('equipDumbbells').checked,
                jumprope: document.getElementById('equipJumprope').checked,
                barbell: document.getElementById('equipBarbell').checked,
                flatBench: document.getElementById('equipFlatBench').checked,
                adjBench: document.getElementById('equipAdjBench').checked,
                sled: document.getElementById('equipSled').checked,
                assaultBike: document.getElementById('equipAssaultBike').checked,
                rower: document.getElementById('equipRower').checked,
                cycle: document.getElementById('equipCycle').checked,
                bicycle: document.getElementById('equipBicycle').checked,
                treadmill: document.getElementById('equipTreadmill').checked,
                swimming: document.getElementById('equipSwimming').checked
            };
        }

        // --- LocalStorage for PT Generator Preferences ---
        const ptGeneratorStorageKey = 'navyPTGeneratorPreferences';
        const rememberPtStorageKey = 'navyPTGeneratorRemember';
        let isLoadingPreferences = false;

        function shouldRememberPTPreferences() {
            return document.getElementById('rememberPtToggle')?.checked || false;
        }

        function savePTGeneratorPreferences() {
            if (isLoadingPreferences) {
                return;
            }
            if (!shouldRememberPTPreferences()) {
                return;
            }
            localStorage.setItem(rememberPtStorageKey, 'true');

            const preferences = {
                focus: document.getElementById('focusSelect').value,
                location: document.getElementById('locationSelect').value,
                scheme: document.getElementById('schemeSelect').value,
                lowImpact: document.getElementById('lowImpactToggle').checked,
                randomWarmup: document.getElementById('randomWarmupToggle').checked,
                injuries: {
                    upper: document.getElementById('injuryUpper')?.checked || false,
                    lower: document.getElementById('injuryLower')?.checked || false
                },
                equipment: {
                    none: document.getElementById('equipNone').checked,
                    adjBench: document.getElementById('equipAdjBench').checked,
                    assaultBike: document.getElementById('equipAssaultBike').checked,
                    barbell: document.getElementById('equipBarbell').checked,
                    dumbbells: document.getElementById('equipDumbbells').checked,
                    flatBench: document.getElementById('equipFlatBench').checked,
                    jumprope: document.getElementById('equipJumprope').checked,
                    kettlebells: document.getElementById('equipKettlebells').checked,
                    pullup: document.getElementById('equipPullup').checked,
                    bands: document.getElementById('equipBands').checked,
                    rower: document.getElementById('equipRower').checked,
                    cycle: document.getElementById('equipCycle').checked,
                    bicycle: document.getElementById('equipBicycle').checked,
                    treadmill: document.getElementById('equipTreadmill').checked,
                    swimming: document.getElementById('equipSwimming').checked,
                    sled: document.getElementById('equipSled').checked
                },
                fundayEquipment: {
                    noEquip: document.getElementById('fundayNoEquip')?.checked || false,
                    // Facilities
                    openField: document.getElementById('fundayOpenField')?.checked || false,
                    basketballCourt: document.getElementById('fundayBasketballCourt')?.checked || false,
                    volleyballCourt: document.getElementById('fundayVolleyballCourt')?.checked || false,
                    baseballField: document.getElementById('fundayBaseballField')?.checked || false,
                    track: document.getElementById('fundayTrack')?.checked || false,
                    // Equipment
                    football: document.getElementById('fundayFootball')?.checked || false,
                    basketball: document.getElementById('fundayBasketball')?.checked || false,
                    volleyball: document.getElementById('fundayVolleyball')?.checked || false,
                    soccer: document.getElementById('fundaySoccer')?.checked || false,
                    frisbee: document.getElementById('fundayFrisbee')?.checked || false,
                    dodgeball: document.getElementById('fundayDodgeball')?.checked || false,
                    kickball: document.getElementById('fundayKickball')?.checked || false,
                    baseball: document.getElementById('fundayBaseball')?.checked || false,
                    flagSet: document.getElementById('fundayFlagSet')?.checked || false,
                    cones: document.getElementById('fundayCones')?.checked || false,
                    tugRope: document.getElementById('fundayTugRope')?.checked || false
                }
            };
            localStorage.setItem(ptGeneratorStorageKey, JSON.stringify(preferences));
        }

        function loadPTGeneratorPreferences() {
            if (!shouldRememberPTPreferences()) {
                return;
            }
            const savedPreferences = localStorage.getItem(ptGeneratorStorageKey);
            if (!savedPreferences) {
                return;
            }

            isLoadingPreferences = true;
            try {
                const preferences = JSON.parse(savedPreferences);

                if (preferences.focus) {
                    document.getElementById('focusSelect').value = preferences.focus;
                }
                if (preferences.location) {
                    document.getElementById('locationSelect').value = preferences.location;
                }
                if (preferences.scheme) {
                    document.getElementById('schemeSelect').value = preferences.scheme;
                }
                if (preferences.lowImpact !== undefined) {
                    document.getElementById('lowImpactToggle').checked = preferences.lowImpact;
                }
                if (preferences.randomWarmup !== undefined) {
                    document.getElementById('randomWarmupToggle').checked = preferences.randomWarmup;
                }
                if (preferences.injuries) {
                    const injuryUpper = document.getElementById('injuryUpper');
                    const injuryLower = document.getElementById('injuryLower');
                    if (injuryUpper) injuryUpper.checked = preferences.injuries.upper;
                    if (injuryLower) injuryLower.checked = preferences.injuries.lower;
                }
                if (preferences.equipment) {
                    Object.entries(preferences.equipment).forEach(([key, value]) => {
                        const element = document.getElementById(`equip${key.charAt(0).toUpperCase() + key.slice(1)}`);
                        if (element) {
                            element.checked = value;
                        }
                    });
                    // Update equipment UI
                    if (preferences.equipment.none) {
                        toggleNone();
                    } else {
                        equipChanged();
                    }
                }

                if (preferences.fundayEquipment) {
                    Object.entries(preferences.fundayEquipment).forEach(([key, value]) => {
                        const element = document.getElementById(`funday${key.charAt(0).toUpperCase() + key.slice(1)}`);
                        if (element) {
                            element.checked = value;
                        }
                    });
                    // Update fun day UI
                    if (preferences.fundayEquipment.noEquip) {
                        toggleFundayNone();
                    } else {
                        fundayEquipChanged();
                    }
                }

                // Update scheme options based on loaded focus
                updateSchemeOptions();
                updateEquipmentOptions();
                updateFundayFacilitiesForLocation();
            } catch (error) {
                console.error('Failed to load PT Generator preferences:', error);
            } finally {
                isLoadingPreferences = false;
            }
        }

        // --- Focus Change Handler (update rep schemes for cardio-only, disable for fun day) ---

        function updateSchemeOptions() {
            const focus = document.getElementById('focusSelect').value;
            const schemeSelect = document.getElementById('schemeSelect');
            const currentValue = schemeSelect.value;

            // Fun Day - disable rep scheme selector
            if (focus === 'funday') {
                schemeSelect.disabled = true;
                schemeSelect.innerHTML = '<option value="funday">N/A - Team Sports</option>';
                return;
            }

            // Yoga Day - disable rep scheme selector
            if (focus === 'yoga') {
                schemeSelect.disabled = true;
                schemeSelect.innerHTML = '<option value="yoga">N/A - Time-Based Stretching</option>';
                return;
            }

            // Re-enable if coming back from fun day or yoga
            schemeSelect.disabled = false;

            // All available schemes
            const allSchemes = [
                { value: 'surprise', text: 'Surprise Me!' },
                { value: 'circuit', text: 'Circuit (3 Rounds x Reps)' },
                { value: 'hiit', text: 'HIIT (40s Work / 20s Rest)' },
                { value: 'military', text: 'Military 4-Count (10 reps)' },
                { value: 'pyramid', text: 'Pyramid (2-4-6-8-10)' },
                { value: 'reversePyramid', text: 'Reverse Pyramid (10-8-6-4-2)' }
            ];

            // Cardio-only appropriate schemes
            const cardioSchemes = [
                { value: 'surprise', text: 'Surprise Me!' },
                { value: 'circuit', text: 'Circuit (3 Rounds x Time)' },
                { value: 'hiit', text: 'HIIT (40s Work / 20s Rest)' }
            ];

            const schemes = (focus === 'cardio') ? cardioSchemes : allSchemes;

            // Clear and rebuild options
            schemeSelect.innerHTML = '';
            schemes.forEach(s => {
                const option = document.createElement('option');
                option.value = s.value;
                option.textContent = s.text;
                schemeSelect.appendChild(option);
            });

            // Try to restore previous selection, or default to first
            const validValues = schemes.map(s => s.value);
            if (validValues.includes(currentValue)) {
                schemeSelect.value = currentValue;
            }
        }

        function updateEquipmentOptions() {
            const focus = document.getElementById('focusSelect').value;
            const equipmentGroup = document.getElementById('equipmentGroup');
            const fundayEquipmentGroup = document.getElementById('fundayEquipmentGroup');
            const equipmentGrid = document.getElementById('equipmentGrid');
            const equipmentCheckboxes = equipmentGrid.querySelectorAll('.equip-checkbox');
            const lowImpactGroup = document.getElementById('lowImpactGroup');

            // Show/hide fun day equipment section
            if (focus === 'funday') {
                fundayEquipmentGroup.style.display = 'block';
                equipmentGroup.style.display = 'none';
            } else {
                fundayEquipmentGroup.style.display = 'none';
                equipmentGroup.style.display = 'block';
            }

            // Disable equipment for Chill Day (Yoga)
            if (focus === 'yoga') {
                equipmentGrid.classList.add('disabled');
                equipmentCheckboxes.forEach(checkbox => {
                    checkbox.classList.add('disabled');
                });
                lowImpactGroup.style.display = 'none';
            } else {
                equipmentGrid.classList.remove('disabled');
                equipmentCheckboxes.forEach(checkbox => {
                    checkbox.classList.remove('disabled');
                });
                lowImpactGroup.style.display = (focus === 'funday') ? 'none' : 'block';
            }
        }

        function updateInjuryOptionsVisibility() {
            const injuryOptions = document.getElementById('injuryOptions');
            const lowImpactToggle = document.getElementById('lowImpactToggle');
            if (!injuryOptions || !lowImpactToggle) {
                return;
            }
            injuryOptions.style.display = lowImpactToggle.checked ? 'flex' : 'none';
        }

        function updateFundayFacilitiesForLocation() {
            const location = document.getElementById('locationSelect').value;
            const hideOutdoor = location === 'indoor';

            const facilityIds = ['fundayOpenField', 'fundayBaseballField', 'fundayTrack'];
            const equipmentIds = ['fundayBaseball'];

            facilityIds.forEach(id => {
                const input = document.getElementById(id);
                if (!input) return;
                const label = input.closest('.equip-checkbox');
                label.style.display = hideOutdoor ? 'none' : 'flex';
                if (hideOutdoor) {
                    input.checked = false;
                }
            });

            equipmentIds.forEach(id => {
                const input = document.getElementById(id);
                if (!input) return;
                const label = input.closest('.equip-checkbox');
                label.style.display = hideOutdoor ? 'none' : 'flex';
                if (hideOutdoor) {
                    input.checked = false;
                }
            });

            if (hideOutdoor) {
                fundayEquipChanged();
            }
        }

        // Initialize on page load and on focus change
        document.getElementById('focusSelect').addEventListener('change', function() {
            updateSchemeOptions();
            updateEquipmentOptions();
            updateFundayFacilitiesForLocation();
            savePTGeneratorPreferences();
        });

        document.getElementById('locationSelect').addEventListener('change', function() {
            updateFundayFacilitiesForLocation();
            savePTGeneratorPreferences();
        });
        document.getElementById('schemeSelect').addEventListener('change', savePTGeneratorPreferences);
        document.getElementById('lowImpactToggle').addEventListener('change', function() {
            updateInjuryOptionsVisibility();
            savePTGeneratorPreferences();
        });
        document.getElementById('rememberPtToggle').addEventListener('change', function() {
            if (shouldRememberPTPreferences()) {
                localStorage.setItem(rememberPtStorageKey, 'true');
                loadPTGeneratorPreferences();
                savePTGeneratorPreferences();
            } else {
                localStorage.removeItem(rememberPtStorageKey);
                localStorage.removeItem(ptGeneratorStorageKey);
            }
        });

        // Add change listeners to all equipment checkboxes
        document.querySelectorAll('.equip-checkbox input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', savePTGeneratorPreferences);
        });

        // Load preferences on page load
        window.addEventListener('DOMContentLoaded', function() {
            const rememberToggle = document.getElementById('rememberPtToggle');
            const rememberStored = localStorage.getItem(rememberPtStorageKey) === 'true';
            if (rememberToggle) {
                rememberToggle.checked = rememberStored;
            }
            if (rememberStored) {
                loadPTGeneratorPreferences();
            } else {
                localStorage.removeItem(ptGeneratorStorageKey);
            }
            updateFundayFacilitiesForLocation();
            updateInjuryOptionsVisibility();
        });

        // --- Collapsible Section Toggle ---

        function toggleSection(id) {
            const el = document.getElementById(id);
            const header = el.previousElementSibling;
            if (el.style.display === 'none') {
                el.style.display = 'block';
                header.querySelector('.toggle-icon').textContent = '‚ñº';
            } else {
                el.style.display = 'none';
                header.querySelector('.toggle-icon').textContent = '‚ñ∂';
            }
        }

        // --- Render Helpers ---

        function getSearchLink(term) {
            return `https://www.google.com/search?q=${encodeURIComponent(term + " exercise technique")}+site:youtube.com`;
        }

        function isPlankExercise(name) {
            const plankKeywords = ['plank', 'pillar bridge'];
            return plankKeywords.some(keyword => name.toLowerCase().includes(keyword));
        }

        function isCoreExercise(name) {
            const coreKeywords = [
                'plank',
                'pillar bridge',
                'hollow',
                'v-up',
                'crunch',
                'flutter',
                'bicycle',
                'dead bug',
                'bird dog',
                'leg raise',
                'knee raise',
                'toes to bar',
                'windshield',
                'pallof',
                'woodchop',
                'l-sit',
                'seated twist',
                'mountain climber'
            ];
            const lowerName = name.toLowerCase();
            return coreKeywords.some(keyword => lowerName.includes(keyword));
        }

        function isCardioExercise(exercise) {
            return exercise.reps !== undefined;
        }

        function renderItem(name, meta, tip = null, alternative = null) {
            const tipHtml = tip ? `<div style="margin-top:5px; font-size:0.85em; color:#ffd700; font-style:italic;">üí° ${tip}</div>` : '';
            const altHtml = alternative
                ? `<div class="exercise-alt">
                        <span class="exercise-alt-label">Low-impact option</span>
                        <span class="exercise-alt-name">${alternative}</span>
                   </div>`
                : '';
            const coreTag = isCoreExercise(name) ? '<span class="meta-pill core">Core</span>' : '';
            return `
                <li class="exercise-item">
                    <div class="exercise-row">
                        <div class="exercise-main">
                            <span class="exercise-name">${name}</span>
                            <div class="exercise-meta">
                                <span class="meta-text">${meta}</span>
                                ${coreTag}
                            </div>
                        </div>
                        ${altHtml}
                    </div>${tipHtml}
                    <a href="${getSearchLink(name)}" target="_blank" class="search-link">‚ñ∂ Watch Demo</a>
                </li>
            `;
        }

        function getLowImpactAlternatives(equip, focus, location) {
            let strengthAlternatives = [];
            let cardioAlternatives = [];
            if (focus !== 'cardio') {
                const strengthDb = db.lowImpact.strength;
                strengthAlternatives = [...strengthAlternatives, ...strengthDb.bodyweight];
                if (equip.bands && strengthDb.bands) strengthAlternatives = [...strengthAlternatives, ...strengthDb.bands];
                if (equip.kettlebells && strengthDb.kettlebells) strengthAlternatives = [...strengthAlternatives, ...strengthDb.kettlebells];
                if (equip.dumbbells && strengthDb.dumbbells) strengthAlternatives = [...strengthAlternatives, ...strengthDb.dumbbells];
                if (equip.flatBench && strengthDb.flatBench) strengthAlternatives = [...strengthAlternatives, ...strengthDb.flatBench];
                if (equip.adjBench && strengthDb.adjBench) strengthAlternatives = [...strengthAlternatives, ...strengthDb.adjBench];
                if (equip.sled && strengthDb.sled) strengthAlternatives = [...strengthAlternatives, ...strengthDb.sled];
            }

            if (focus !== 'strength') {
                const cardioDb = db.lowImpact.cardio;
                cardioAlternatives = [
                    ...cardioAlternatives,
                    ...(location === 'indoor' ? cardioDb.indoor : cardioDb.outdoor)
                ];
                if (equip.assaultBike && cardioDb.assaultBike) cardioAlternatives = [...cardioAlternatives, ...cardioDb.assaultBike];
                if (equip.rower && cardioDb.rower) cardioAlternatives = [...cardioAlternatives, ...cardioDb.rower];
                if ((equip.cycle || equip.bicycle) && cardioDb.cycle) cardioAlternatives = [...cardioAlternatives, ...cardioDb.cycle];
                if (equip.bicycle && cardioDb.bicycle) cardioAlternatives = [...cardioAlternatives, ...cardioDb.bicycle];
                if (equip.treadmill && cardioDb.treadmill) cardioAlternatives = [...cardioAlternatives, ...cardioDb.treadmill];
            }

            return { strengthAlternatives, cardioAlternatives };
        }

        function getInjurySelections() {
            return {
                upper: document.getElementById('injuryUpper')?.checked || false,
                lower: document.getElementById('injuryLower')?.checked || false
            };
        }

        function getExerciseGroup(exerciseName, isCardio) {
            const name = exerciseName.toLowerCase();
            if (isCardio) {
                return 'lower';
            }
            const upperKeywords = ['push', 'press', 'curl', 'row', 'pull', 'tricep', 'bicep', 'dip', 'plank', 'shoulder', 'arm', 'chest', 'y-t-w'];
            const lowerKeywords = ['squat', 'lunge', 'deadlift', 'bridge', 'calf', 'step', 'glute', 'hip', 'thrust', 'hinge', 'good morning'];

            if (lowerKeywords.some(keyword => name.includes(keyword))) {
                return 'lower';
            }
            if (upperKeywords.some(keyword => name.includes(keyword))) {
                return 'upper';
            }
            return 'full';
        }

        function filterAlternativesByInjury(alternatives, injuries) {
            return alternatives.filter(ex => {
                const group = getExerciseGroup(ex.name, isCardioExercise(ex));
                if (injuries.upper && group === 'upper') return false;
                if (injuries.lower && group === 'lower') return false;
                return true;
            });
        }

        function pickAlternativeFromPool(pool, targetGroup, isCardio) {
            if (!pool.length) {
                return null;
            }
            const matchIndex = pool.findIndex(item => getExerciseGroup(item.name, isCardio) === targetGroup);
            if (matchIndex >= 0) {
                return pool.splice(matchIndex, 1)[0];
            }
            return pool.pop() || null;
        }

        function renderCollapsibleHeader(title, contentId, expanded = true) {
            const icon = expanded ? '‚ñº' : '‚ñ∂';
            return `<div class="section-header" style="cursor:pointer;" onclick="toggleSection('${contentId}')">
                        <span class="toggle-icon">${icon}</span> ${title}
                    </div>`;
        }

        // --- Main Generate Function ---

        function generateWorkout() {
            const focus = document.getElementById('focusSelect').value;
            const location = document.getElementById('locationSelect').value;
            let scheme = document.getElementById('schemeSelect').value;
            const lowImpact = document.getElementById('lowImpactToggle')?.checked || false;
            const equip = getSelectedEquipment();
            const out = document.getElementById('workoutOutput');

            // Scheme descriptions
            const schemeDesc = {
                circuit: { meta: "3 Rounds x 12-15 Reps", note: "Perform as a circuit. Rest 60s between rounds." },
                hiit: { meta: "40s Work / 20s Rest", note: "Tabata style. Complete 3-4 rounds of all exercises." },
                military: { meta: "10 Reps (4-Count)", note: "CFL leads count: 1-2-3-ONE... to 1-2-3-TEN. Planks: 15+ echo count." },
                pyramid: { meta: "Pyramid: 2-4-6-8-10", note: "Build up reps each round. Rest as needed between rounds." },
                reversePyramid: { meta: "Reverse Pyramid: 10-8-6-4-2", note: "Decrease reps each round. Stay strong as fatigue sets in." }
            };

            // Handle "Surprise Me" - pick random scheme appropriate for focus
            if (scheme === 'surprise') {
                if (focus === 'cardio') {
                    // Cardio-only: HIIT is most appropriate, or circuit with time-based
                    const cardioSchemes = ['hiit', 'circuit'];
                    scheme = cardioSchemes[Math.floor(Math.random() * cardioSchemes.length)];
                } else {
                    // Strength or Mixed: any scheme works
                    const allSchemes = ['circuit', 'hiit', 'military', 'pyramid', 'reversePyramid'];
                    scheme = allSchemes[Math.floor(Math.random() * allSchemes.length)];
                }
            }

            // Get exercise-specific rep scheme
            function getExerciseReps(exercise, scheme) {
                // Cardio exercises use their own reps
                if (isCardioExercise(exercise)) {
                    return exercise.reps;
                }

                // Planks use echo count for military 4-count
                if (scheme === 'military' && isPlankExercise(exercise.name)) {
                    return "15-20 Echo Count";
                }

                // Standard scheme reps
                return schemeDesc[scheme].meta;
            }

            // 1. Warmup (Collapsible - collapsed by default)
            const randomWarmup = document.getElementById('randomWarmupToggle').checked;
            const warmupTitle = randomWarmup ? '1. Randomized Warm-Up (10-12 Min)' : '1. Standardized Warm-Up (10-12 Min)';
            let html = renderCollapsibleHeader(warmupTitle, 'warmupContent', false);
            html += `<ul class="exercise-list" id="warmupContent" style="display:none">`;

            if (randomWarmup) {
                // Randomize: pick 8-10 exercises from the warmup pool
                const shuffledWarmup = [...warmupExercises].sort(() => Math.random() - 0.5);
                const selectedWarmup = shuffledWarmup.slice(0, 10);
                selectedWarmup.forEach(ex => html += renderItem(ex.name, ex.rep));
            } else {
                // Standard: use official NOFFS sequence (first 10 exercises)
                warmupExercises.slice(0, 10).forEach(ex => html += renderItem(ex.name, ex.rep));
            }

            if (focus === 'mixed' || focus === 'cardio' || focus === 'funday') {
                html += `<li style="padding:10px; color:#4a90e2; font-weight:bold; background:none; border:none;">‚Äî Pre-Cardio Additions ‚Äî</li>`;
                preCardioWarmup.forEach(ex => html += renderItem(ex.name, ex.rep));
            }
            html += `</ul>`;

            // Handle Fun Day separately
            if (focus === 'funday') {
                const fundayActivities = location === 'indoor' ? db.funday.indoor : db.funday.outdoor;

                // Get selected fun day equipment
                const noEquipment = document.getElementById('fundayNoEquip')?.checked || false;
                const selectedFundayEquip = {
                    // Facilities
                    openField: document.getElementById('fundayOpenField')?.checked || false,
                    basketballCourt: document.getElementById('fundayBasketballCourt')?.checked || false,
                    volleyballCourt: document.getElementById('fundayVolleyballCourt')?.checked || false,
                    baseballField: document.getElementById('fundayBaseballField')?.checked || false,
                    track: document.getElementById('fundayTrack')?.checked || false,
                    // Equipment
                    football: document.getElementById('fundayFootball')?.checked || false,
                    basketball: document.getElementById('fundayBasketball')?.checked || false,
                    volleyball: document.getElementById('fundayVolleyball')?.checked || false,
                    soccer: document.getElementById('fundaySoccer')?.checked || false,
                    frisbee: document.getElementById('fundayFrisbee')?.checked || false,
                    dodgeball: document.getElementById('fundayDodgeball')?.checked || false,
                    kickball: document.getElementById('fundayKickball')?.checked || false,
                    baseball: document.getElementById('fundayBaseball')?.checked || false,
                    flagSet: document.getElementById('fundayFlagSet')?.checked || false,
                    cones: document.getElementById('fundayCones')?.checked || false,
                    tugRope: document.getElementById('fundayTugRope')?.checked || false
                };

                // Filter activities based on equipment availability
                let filteredActivities;

                if (noEquipment) {
                    // Only show no-equipment games
                    const allNoEquipGames = fundayActivities.filter(activity => activity.noEquipment === true);

                    // Check if any facilities are selected
                    const selectedFacilities = Object.keys(selectedFundayEquip).filter(key =>
                        ['openField', 'basketballCourt', 'volleyballCourt', 'baseballField', 'track'].includes(key) &&
                        selectedFundayEquip[key]
                    );

                    if (selectedFacilities.length > 0) {
                        // Prioritize games that match selected facilities
                        const facilityMatchGames = allNoEquipGames.filter(activity =>
                            activity.preferredFacility && selectedFacilities.includes(activity.preferredFacility)
                        );
                        const genericGames = allNoEquipGames.filter(activity => !activity.preferredFacility);

                        // Combine: facility-specific games first, then generic games
                        filteredActivities = [...facilityMatchGames, ...genericGames];
                    } else {
                        // No facilities selected, show all no-equipment games
                        filteredActivities = allNoEquipGames;
                    }
                } else {
                    // Show games based on selected equipment
                    filteredActivities = fundayActivities.filter(activity => {
                        // Always include no-equipment games
                        if (activity.noEquipment) return true;

                        // If activity requires specific equipment, check if we have it
                        if (activity.requires) {
                            return selectedFundayEquip[activity.requires] === true;
                        }

                        // Include all other activities
                        return true;
                    });
                }

                // If filtering resulted in empty list, use all activities
                if (filteredActivities.length === 0) {
                    filteredActivities = fundayActivities;
                }

                const shuffled = filteredActivities.sort(() => 0.5 - Math.random());
                const primary = shuffled[0];
                const alternatives = shuffled.slice(1, 4);

                html += `<div class="section-header">2. Fun Day Activity (40-45 Min)</div>`;
                html += `<p style="margin-bottom:15px; padding:15px; background:rgba(255,215,0,0.1); border-radius:8px; border:1px solid rgba(255,215,0,0.3); font-size:0.95em;">
                            <strong style="color:#ffd700; font-size:1.2em;">Today's Activity: ${primary.name}</strong><br>
                            <span style="color:#8fa3bf;">üí° ${primary.tip}</span>
                            ${primary.link ? `<br><a href="${primary.link}" target="_blank" style="color:#4a90e2; text-decoration:none; font-size:0.9em; margin-top:8px; display:inline-block;">‚ñ∂ Watch How to Play</a>` : ''}
                         </p>`;

                html += `<p style="margin-bottom:10px; color:#8fa3bf; font-size:0.9em;"><strong>Alternative Options:</strong></p>`;
                html += `<ul class="exercise-list">`;
                alternatives.forEach(activity => {
                    const linkHtml = activity.link ? `<br><a href="${activity.link}" target="_blank" style="color:#4a90e2; text-decoration:none; font-size:0.85em;">‚ñ∂ Watch How to Play</a>` : '';
                    html += `<li class="exercise-item">
                                <span class="exercise-name">${activity.name}</span>
                                <div class="exercise-meta">Team Sport</div>
                                <div style="margin-top:5px; font-size:0.85em; color:#ffd700; font-style:italic;">üí° ${activity.tip}${linkHtml}</div>
                             </li>`;
                });
                html += `</ul>`;

                html += `<p style="margin-top:15px; padding:12px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.85em; color:#8fa3bf;">
                            <strong>CFL Tips:</strong> Emphasize safety and no tackling. Use two-hand touch/tag rules, ensure equal teams, establish clear rules before starting,
                            rotate positions/teams regularly, and keep water breaks every 15-20 min. Focus on participation over competition.
                         </p>`;

                // Skip to cool-down for fun day (collapsed by default)
                html += renderCollapsibleHeader('3. Cool-Down (5-8 Min)', 'cooldownContent', false);
                html += `<ul class="exercise-list" id="cooldownContent" style="display:none">`;
                cooldownExercises.forEach(ex => html += renderItem(ex.name, ex.desc, ex.tip));
                html += `</ul>`;

                out.innerHTML = html;
                out.style.display = 'block';
                document.getElementById('exportSection').style.display = 'flex';
                out.scrollIntoView({ behavior: 'smooth' });
                return; // Exit early for fun day
            }

            // Handle Yoga/Chill Day separately (no warmup/cooldown needed)
            if (focus === 'yoga') {
                const yogaPoses = [...db.yoga].sort(() => 0.5 - Math.random());
                const selectedPoses = yogaPoses.slice(0, 12); // Select 12 poses

                // Always end with Corpse Pose (Savasana) if not already included
                const savasana = db.yoga.find(p => p.name.includes('Savasana'));
                const hasSavasana = selectedPoses.some(p => p.name.includes('Savasana'));
                if (!hasSavasana && savasana) {
                    selectedPoses.pop();
                    selectedPoses.push(savasana);
                }

                let html = `<div class="section-header">üßò Chill Day - Yoga & Stretching (45-60 Min)</div>`;
                html += `<p style="margin-bottom:15px; padding:15px; background:rgba(147,112,219,0.15); border-radius:8px; border:1px solid rgba(147,112,219,0.3); font-size:0.95em;">
                            <strong style="color:#9370db;">Today's Focus: Recovery & Relaxation</strong><br>
                            <span style="color:#8fa3bf;">Move slowly, breathe deeply, and listen to your body. Hold each pose for the indicated time.</span>
                         </p>`;

                html += `<ul class="exercise-list">`;
                selectedPoses.forEach(pose => {
                    html += renderItem(pose.name, pose.duration, pose.tip);
                });
                html += `</ul>`;

                html += `<p style="margin-top:15px; padding:12px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.85em; color:#8fa3bf;">
                            <strong>CFL Tips:</strong> Dim lights if possible, play calming music, encourage deep breathing throughout.
                            Remind participants to never push through pain - modifications are always okay.
                         </p>`;

                out.innerHTML = html;
                out.style.display = 'block';
                document.getElementById('exportSection').style.display = 'flex';
                out.scrollIntoView({ behavior: 'smooth' });
                return; // Exit early for yoga day
            }

            // 2. Main Workout (for non-fun day)
            html += `<div class="section-header">2. Main Session (${focus.toUpperCase()} - 40 Min)</div>`;
            html += `<p style="margin-bottom:15px; padding:10px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.9em;">
                        <strong>Format:</strong> ${schemeDesc[scheme].meta}<br>
                        <em>${schemeDesc[scheme].note}</em>
                     </p>`;
            if (lowImpact) {
                const cardioNote = (focus === 'cardio' || focus === 'mixed')
                    ? `<br><strong>Cardio Tip:</strong> Prioritize stationary bike or an actual bike to keep up with the team, or choose rower/incline walk if available.`
                    : '';
                html += `<p style="margin-bottom:15px; padding:10px; background:rgba(74,144,226,0.08); border-radius:6px; font-size:0.9em; color:#8fa3bf;">
                            <strong>Low-Impact Mode:</strong> Use controlled tempo, reduce jumping, and choose joint-friendly options. Low-impact alternatives are shown to the right of each exercise.${cardioNote}
                         </p>`;
            }
            html += `<ul class="exercise-list">`;

            let mainPool = [];

            if (focus !== 'cardio') {
                const strengthDb = db.strength;
                mainPool = [...mainPool, ...strengthDb.bodyweight];
                if (equip.bands && strengthDb.bands) mainPool = [...mainPool, ...strengthDb.bands];
                if (equip.pullup && strengthDb.pullup) mainPool = [...mainPool, ...strengthDb.pullup];
                if (equip.kettlebells && strengthDb.kettlebells) mainPool = [...mainPool, ...strengthDb.kettlebells];
                if (equip.dumbbells && strengthDb.dumbbells) mainPool = [...mainPool, ...strengthDb.dumbbells];
                if (equip.barbell && strengthDb.barbell) mainPool = [...mainPool, ...strengthDb.barbell];
                if (equip.flatBench && strengthDb.flatBench) mainPool = [...mainPool, ...strengthDb.flatBench];
                if (equip.adjBench && strengthDb.adjBench) mainPool = [...mainPool, ...strengthDb.adjBench];
                if (equip.sled && strengthDb.sled) mainPool = [...mainPool, ...strengthDb.sled];
            }

            if (focus !== 'strength') {
                const cardioDb = db.cardio;
                mainPool = [...mainPool, ...(location === 'indoor' ? cardioDb.indoor : cardioDb.outdoor)];
                if (equip.jumprope && cardioDb.jumprope) mainPool = [...mainPool, ...cardioDb.jumprope];
                if (equip.assaultBike && cardioDb.assaultBike) mainPool = [...mainPool, ...cardioDb.assaultBike];
                if (equip.rower && cardioDb.rower) mainPool = [...mainPool, ...cardioDb.rower];
                if (equip.cycle && cardioDb.cycle) mainPool = [...mainPool, ...cardioDb.cycle];
                if (equip.bicycle && cardioDb.bicycle) mainPool = [...mainPool, ...cardioDb.bicycle];
                if (equip.treadmill && cardioDb.treadmill) mainPool = [...mainPool, ...cardioDb.treadmill];
            }

            // Separate finishers from regular exercises
            const regularExercises = mainPool.filter(ex => !ex.isFinisher);
            const finisherExercises = mainPool.filter(ex => ex.isFinisher);

            // Shuffle both pools
            const shuffledRegular = regularExercises.sort(() => 0.5 - Math.random());
            const shuffledFinishers = finisherExercises.sort(() => 0.5 - Math.random());

            // Select exercises: fill with regular first, then add one finisher at end if available
            const count = 8;
            let selected = [];

            // Take regular exercises (leave room for 1 finisher if we have finishers)
            const regularCount = shuffledFinishers.length > 0 ? Math.min(count - 1, shuffledRegular.length) : Math.min(count, shuffledRegular.length);
            selected = shuffledRegular.slice(0, regularCount);

            // Add one finisher at the end if available and we have room
            if (shuffledFinishers.length > 0 && selected.length < count) {
                selected.push(shuffledFinishers[0]);
            }

            // Fill remaining slots with more regular exercises if needed
            if (selected.length < count && shuffledRegular.length > regularCount) {
                const remaining = shuffledRegular.slice(regularCount, regularCount + (count - selected.length));
                // Insert before the finisher if one exists
                if (shuffledFinishers.length > 0 && selected.length > 0 && selected[selected.length - 1].isFinisher) {
                    const finisher = selected.pop();
                    selected = [...selected, ...remaining, finisher];
                } else {
                    selected = [...selected, ...remaining];
                }
            }

            const lowImpactAlternatives = lowImpact ? getLowImpactAlternatives(equip, focus, location) : {
                strengthAlternatives: [],
                cardioAlternatives: []
            };
            const injuries = getInjurySelections();
            const shuffledStrengthAlternatives = filterAlternativesByInjury(lowImpactAlternatives.strengthAlternatives, injuries)
                .sort(() => 0.5 - Math.random());
            const shuffledCardioAlternatives = filterAlternativesByInjury(lowImpactAlternatives.cardioAlternatives, injuries)
                .sort(() => 0.5 - Math.random());

            selected.forEach(ex => {
                const reps = getExerciseReps(ex, scheme);
                const isCardio = isCardioExercise(ex);
                const targetGroup = getExerciseGroup(ex.name, isCardio);
                let alternative = null;
                if (lowImpact) {
                    const pool = isCardio ? shuffledCardioAlternatives : shuffledStrengthAlternatives;
                    alternative = pickAlternativeFromPool(pool, targetGroup, isCardio)?.name || null;
                    if (!alternative) {
                        alternative = 'Scale impact (slow tempo, reduced range)';
                    }
                }
                html += renderItem(ex.name, reps, ex.tip, alternative);
            });
            html += `</ul>`;

            // 3. Cool-Down (Collapsible - collapsed by default)
            html += renderCollapsibleHeader('3. Cool-Down (5-8 Min)', 'cooldownContent', false);
            html += `<ul class="exercise-list" id="cooldownContent" style="display:none">`;
            cooldownExercises.forEach(ex => html += renderItem(ex.name, ex.desc, ex.tip));
            html += `</ul>`;

            out.innerHTML = html;
            out.style.display = 'block';
            document.getElementById('exportSection').style.display = 'flex';
            out.scrollIntoView({ behavior: 'smooth' });
        }

        // Export Functions for PT Generator
        function exportWorkoutToCSV() {
            const workoutOutput = document.getElementById('workoutOutput');
            if (workoutOutput.style.display === 'none') {
                alert('Please generate a workout first before exporting.');
                return;
            }

            // Get workout details
            const focus = document.getElementById('focusSelect').options[document.getElementById('focusSelect').selectedIndex].text;
            const location = document.getElementById('locationSelect').options[document.getElementById('locationSelect').selectedIndex].text;
            const scheme = document.getElementById('schemeSelect').options[document.getElementById('schemeSelect').selectedIndex].text;
            const today = new Date().toISOString().split('T')[0];

            // Parse workout content
            let csv = 'Navy Command PT Session\n';
            csv += `Date,${today}\n`;
            csv += `Focus,${focus}\n`;
            csv += `Location,${location}\n`;
            csv += `Rep Scheme,${scheme}\n`;
            csv += `\n`;

            // Extract exercises from the workout output
            const sections = workoutOutput.querySelectorAll('.section-header');
            const exerciseLists = workoutOutput.querySelectorAll('.exercise-list');

            sections.forEach((section, index) => {
                const sectionTitle = section.textContent.replace('‚ñº', '').replace('‚ñ∂', '').trim();
                csv += `\n${sectionTitle}\n`;
                csv += 'Exercise,Reps/Duration\n';

                if (exerciseLists[index]) {
                    const exercises = exerciseLists[index].querySelectorAll('.exercise-item');
                    exercises.forEach(exercise => {
                        const name = exercise.querySelector('.exercise-name')?.textContent || '';
                        const meta = exercise.querySelector('.exercise-meta')?.textContent || '';
                        csv += `"${name}","${meta}"\n`;
                    });
                }
            });

            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Navy-PT-Session-${today}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function exportWorkoutToPDF() {
            const workoutOutput = document.getElementById('workoutOutput');
            if (workoutOutput.style.display === 'none') {
                alert('Please generate a workout first before printing.');
                return;
            }

            window.print();
        }
    </script>
</body>

</html>
