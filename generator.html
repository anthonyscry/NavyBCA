<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navy PT Generator | Command PT Session Builder</title>
    <meta name="description"
        content="Generate safe, effective 60-minute Navy physical training sessions for Command PT. Print-ready format for CFLs and ACFLs.">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öì</text></svg>">

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4254899096040096"
        crossorigin="anonymous"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7D2BBFK1WP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-7D2BBFK1WP');
    </script>

    <style>
        /* Base Styles - Matching index.html */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a2a4a 50%, #0d1829 100%);
            min-height: 100vh;
            color: #e8eef5;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(90deg, #ffd700, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
        }

        .subtitle {
            color: #8fa3bf;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .btn-back {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 8px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calculator-card {
            background: rgba(20, 35, 60, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(100, 130, 180, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 30px;
            margin-bottom: 30px;
        }

        .card-header {
            border-bottom: 1px solid rgba(100, 130, 180, 0.2);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .card-header h2 {
            color: #ffd700;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #8fa3bf;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .equip-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .equip-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            border: 1px solid rgba(100, 130, 180, 0.3);
            transition: all 0.2s;
        }

        .equip-checkbox:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .equip-checkbox.none-selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .equip-checkbox input {
            accent-color: #ffd700;
        }

        .equip-checkbox.disabled {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        .equip-grid.disabled {
            opacity: 0.5;
        }

        select {
            width: 100%;
            padding: 12px;
            background: #1e3250;
            border: 1px solid #4a90e2;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        select:focus {
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);
        }

        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(30, 50, 80, 0.3);
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ffd700 0%, #b8860b 100%);
            color: #0a1628;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        /* Ad Container Styles */
        .ad-container {
            background: rgba(30, 50, 80, 0.3);
            border: 1px dashed rgba(100, 130, 180, 0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            min-height: 90px;
        }

        .ad-container.large {
            min-height: 250px;
        }

        .ad-label {
            color: #6b7c94;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* PPAQ Section - Inline (Not Popup) */
        .ppaq-section {
            background: rgba(255, 215, 0, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .ppaq-title {
            color: #ffd700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ppaq-list {
            font-size: 0.95em;
        }

        .ppaq-item {
            padding: 8px 0;
            display: flex;
            gap: 10px;
            border-bottom: 1px dashed rgba(255, 215, 0, 0.1);
        }

        .ppaq-item:last-child {
            border-bottom: none;
        }

        .ppaq-number {
            color: #ffd700;
            font-weight: bold;
            min-width: 25px;
        }

        .ppaq-warning {
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 15px;
            font-size: 0.9em;
            text-align: center;
        }

        /* Workout Output */
        #workoutOutput {
            display: none;
            margin-top: 30px;
            border-top: 1px solid rgba(100, 130, 180, 0.3);
            padding-top: 30px;
        }

        .section-header {
            color: #ffd700;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 10px;
            margin: 30px 0 15px 0;
        }

        .section-header:first-child {
            margin-top: 0;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-item {
            background: rgba(255, 255, 255, 0.03);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-left: 3px solid #4a90e2;
        }

        .exercise-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #fff;
        }

        .exercise-meta {
            font-size: 0.9em;
            color: #8fa3bf;
        }

        .search-link {
            color: #4a90e2;
            text-decoration: none;
            font-size: 0.85em;
            display: inline-block;
            margin-top: 5px;
        }

        .search-link:hover {
            text-decoration: underline;
            color: #ffd700;
        }

        footer {
            text-align: center;
            color: #6b7c94;
            font-size: 12px;
            padding: 30px;
        }

        footer a {
            color: #8fa3bf;
            text-decoration: none;
        }

        footer a:hover {
            color: #ffd700;
        }

        /* PT Banner */
        .pt-banner {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px 30px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .pt-banner-text {
            flex: 1;
        }

        .pt-banner-text h3 {
            color: #ffd700;
            margin: 0 0 8px 0;
            font-size: 20px;
        }

        .pt-banner-text p {
            color: #e8eef5;
            margin: 0;
            font-size: 14px;
        }

        .pt-banner-btn {
            background: linear-gradient(135deg, #ffd700, #b8860b);
            color: #0a1628;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .pt-banner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        /* Mobile responsive PT banner */
        @media (max-width: 768px) {
            .pt-banner {
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
                gap: 15px;
            }

            .pt-banner-text h3 {
                font-size: 18px;
            }

            .pt-banner-text p {
                font-size: 13px;
            }

            .pt-banner-btn {
                width: 100%;
                text-align: center;
                white-space: normal;
                padding: 14px 20px;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            .container {
                max-width: 100%;
                padding: 10px;
            }

            .btn-back,
            .action-btn,
            .search-link,
            .ad-container,
            .pt-banner {
                display: none !important;
            }

            header {
                padding: 10px 0;
            }

            h1 {
                -webkit-text-fill-color: black !important;
                color: black !important;
                font-size: 24px;
            }

            .subtitle {
                color: #666 !important;
            }

            .calculator-card {
                background: white !important;
                border: 1px solid #ccc;
                box-shadow: none;
                padding: 15px;
            }

            .ppaq-section {
                background: #f9f9f9 !important;
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }

            .ppaq-title {
                color: #333 !important;
            }

            .ppaq-number {
                color: #333 !important;
            }

            .ppaq-warning {
                color: red !important;
            }

            .section-header {
                color: #333 !important;
                border-color: #333 !important;
            }

            .exercise-item {
                background: #f5f5f5 !important;
                border-left-color: #333 !important;
                page-break-inside: avoid;
            }

            .exercise-name {
                color: black !important;
            }

            .exercise-meta {
                color: #666 !important;
            }

            footer {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Top Ad Banner -->
        <div class="ad-container">
            <span class="ad-label">Advertisement</span>
        </div>

        <a href="index.html" class="btn-back">‚Üê Back to Calculator</a>

        <header>
            <div class="logo-container">
                <div class="logo">‚öì</div>
                <h1>Navy PT Generator</h1>
            </div>
            <p class="subtitle">Command Physical Training Session Builder</p>
        </header>

        <!-- Watchbill Generator Banner -->
        <div class="pt-banner">
            <div class="pt-banner-text">
                <h3>Need a Monthly PT Watchbill?</h3>
                <p>Auto-generate PT schedules with CFL rotation. Select days, assign CFLs, print ready.</p>
            </div>
            <a href="watchbill.html" class="pt-banner-btn">
                Command PT Watchbill Generator ‚Üí
            </a>
        </div>

        <main class="calculator-card">
            <!-- PPAQ Section - Always Visible for CFLs -->
            <div class="ppaq-section">
                <div class="ppaq-title">üìã Pre-Physical Activity Questions (PPAQ)</div>
                <p style="font-size: 0.85em; color: #8fa3bf; margin-bottom: 15px;">CFLs/ACFLs: Read aloud before each
                    session.</p>
                <div class="ppaq-list">
                    <div class="ppaq-item"><span class="ppaq-number">1.</span><span>Do you have a current Periodic
                            Health Assessment (PHA)?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">2.</span><span>Do you have chest pain, bone/joint
                            pain, high blood pressure, or high cholesterol?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">3.</span><span>Do you have Sickle Cell Trait
                            (SCT)?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">4.</span><span>Have you had a change in medical
                            status since your last PHA?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">5.</span><span>Are you ill today or aware of any
                            condition preventing participation?</span></div>
                    <div class="ppaq-item"><span class="ppaq-number">6.</span><span>Reservists (if applicable): Are you on active duty
                            orders or in drill status?</span></div>
                </div>
                <p class="ppaq-warning">‚ö†Ô∏è If YES to risk factors or NO to PHA/Clearance ‚áí Do NOT Participate.</p>
            </div>

            <!-- Controls -->
            <div class="card-header">
                <h2>Session Options</h2>
            </div>
            <div class="controls-grid">
                <div class="form-group">
                    <label>Focus</label>
                    <select id="focusSelect">
                        <option value="mixed">Mixed (Strength & Cardio)</option>
                        <option value="strength">Strength Focus</option>
                        <option value="cardio">Cardio Focus</option>
                        <option value="funday">Fun Day (Team Sports)</option>
                        <option value="yoga">Chill Day (Yoga/Stretching)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <select id="locationSelect">
                        <option value="outdoor">Outdoor (Track/Field)</option>
                        <option value="indoor">Indoor (Gym/Home)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Rep Scheme</label>
                    <select id="schemeSelect">
                        <option value="surprise">Surprise Me!</option>
                        <option value="circuit">Circuit (3 Rounds x Reps)</option>
                        <option value="hiit">HIIT (40s Work / 20s Rest)</option>
                        <option value="military">Military 4-Count (10 reps)</option>
                        <option value="pyramid">Pyramid (2-4-6-8-10)</option>
                        <option value="reversePyramid">Reverse Pyramid (10-8-6-4-2)</option>
                    </select>
                </div>
            </div>

            <div class="form-group" id="equipmentGroup">
                <label>Equipment Available</label>
                <div class="equip-grid" id="equipmentGrid">
                    <label class="equip-checkbox none-selected">
                        <input type="checkbox" id="equipNone" checked onchange="toggleNone()"> None (Bodyweight Only)
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipAdjBench" onchange="equipChanged()"> Adjustable Bench
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipAssaultBike" onchange="equipChanged()"> Assault Bike
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipBarbell" onchange="equipChanged()"> Barbell
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipDumbbells" onchange="equipChanged()"> Dumbbells
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipFlatBench" onchange="equipChanged()"> Flat Bench
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipJumprope" onchange="equipChanged()"> Jump Rope
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipKettlebells" onchange="equipChanged()"> Kettlebells
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipPullup" onchange="equipChanged()"> Pull-up Bar
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipBands" onchange="equipChanged()"> Resistance Bands
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipRower" onchange="equipChanged()"> Rowing Machine
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipCycle" onchange="equipChanged()"> Stationary Cycle
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipTreadmill" onchange="equipChanged()"> Treadmill
                    </label>
                    <label class="equip-checkbox">
                        <input type="checkbox" class="equip-item" id="equipSled" onchange="equipChanged()"> Weight Sled
                    </label>
                </div>
            </div>

            <button class="action-btn" onclick="generateWorkout()">Generate 60-Minute Session</button>

            <!-- Mid-Section Ad -->
            <div class="ad-container">
                <span class="ad-label">Advertisement</span>
            </div>

            <div id="workoutOutput"></div>

            <p style="margin-top: 20px; font-size: 12px; color: #6b7c94; text-align: center;">
                * All exercises filtered to remove contraindicated movements per NOFFS guidelines.
            </p>
        </main>

        <!-- Large Ad Unit -->
        <div class="ad-container large">
            <span class="ad-label">Advertisement</span>
        </div>

        <footer>
            <p>Based on Navy Physical Readiness Program Guide-4 (December 2025)</p>
            <p>
                <a href="references.html">References & Guides</a> |
                <a href="index.html">BCA Calculator</a> |
                <a href="generator.html">PT Generator</a> |
                <a href="watchbill.html">Watchbill Generator</a> |
                <a href="about.html">About</a> |
                <a href="privacy.html">Privacy Policy</a> |
                <a href="terms.html">Terms of Use</a> |
                <a href="mailto:administrator@navybca.com">Contact</a>
            </p>
            <p style="margin-top: 10px;">Disclaimer: This site is not an official U.S. Navy website. This is an unofficial tool for planning purposes only.</p>
        </footer>
    </div>

    <script>
        // --- Data: Official Lists ---

        const warmupExercises = [
            { name: "90/90 Stretch", rep: "5 reps/side" },
            { name: "Pillar Bridge", rep: "20 sec hold" },
            { name: "Glute Bridge", rep: "10 reps" },
            { name: "Bent Over T's", rep: "10 reps" },
            { name: "Knee Hug", rep: "5 reps/side" },
            { name: "Reverse Lunge w/ Rotation", rep: "5 reps/side" },
            { name: "Heel-to-Glute w/ Reach", rep: "5 reps/side" },
            { name: "Squats", rep: "10 reps" },
            { name: "Drop Squat to 2-inch Run", rep: "2 reps (3s run)" },
            { name: "Drop Squat to High Knees", rep: "2 reps (3s high knees)" }
        ];

        const preCardioWarmup = [
            { name: "Inverted Hamstring", rep: "5 reps/side" },
            { name: "Leg Cradle", rep: "5 reps/side" },
            { name: "Linear March", rep: "10 yards" },
            { name: "Squat Jump Countermovement", rep: "5 reps" }
        ];

        const cooldownExercises = [
            { name: "Chest Stretch", desc: "10 echo count", tip: "Clasp hands behind neck, pull elbows back" },
            { name: "Posterior Shoulder Stretch", desc: "10 echo count/side", tip: "Pull arm across body" },
            { name: "Triceps Stretch", desc: "10 echo count/side", tip: "Reach behind back, push elbow" },
            { name: "Hip Flexor Stretch", desc: "10 echo count/side", tip: "Lunge position, push hip forward" },
            { name: "Groin/Butterfly Stretch", desc: "10 echo count", tip: "Seated, soles together" },
            { name: "Modified Hurdler Stretch", desc: "10 echo count/side", tip: "Seated V-position, reach for toes" },
            { name: "Outer Hip/Low Back Stretch", desc: "10 echo count/side", tip: "Seated twist" },
            { name: "Piriformis Stretch", desc: "10 echo count/side", tip: "Lying, cross leg over thigh" },
            { name: "Low Back Stretch", desc: "10 echo count", tip: "Knees to chest" },
            { name: "Quadriceps Stretch", desc: "10 echo count/side", tip: "Standing/lying, pull heel to glute" },
            { name: "Calf Stretch", desc: "10 echo count/side", tip: "Push-up position, press heel down" }
        ];

        const db = {
            strength: {
                bodyweight: [
                    { name: "Standard Pushups", tip: "Keep core tight, elbows at 45¬∞. Feel it in chest and triceps." },
                    { name: "Wide-Arm Pushups", tip: "Hands wider than shoulders. Focus on chest stretch at bottom." },
                    { name: "Diamond Pushups", tip: "Hands form diamond under chest. Triceps focus. Modify on knees if needed." },
                    { name: "Hand-Release Pushups", tip: "Chest touches deck, lift hands, then push. Full range of motion." },
                    { name: "Decline Pushups", tip: "Feet elevated. Increases shoulder and upper chest activation." },
                    { name: "Standard Plank", tip: "Straight line ear to ankle. Don't sag hips. Engage core." },
                    { name: "Side Plank (L/R)", tip: "Stack feet or stagger. Keep hips high. Feel obliques working." },
                    { name: "Bird Dog", tip: "Opposite arm/leg extend. Keep back flat. Core stability." },
                    { name: "Dead Bug", tip: "Press low back into deck. Move slow and controlled." },
                    { name: "Air Squats", tip: "Weight in heels, knees track toes. Thighs parallel. Core tight." },
                    { name: "Walking Lunges", tip: "Chest up, front knee behind toes. Feel glutes and quads." },
                    { name: "Calf Raises", tip: "Full extension at top, slow lower. Feel the burn in calves." },
                    { name: "Wall Sit", tip: "Thighs parallel, back flat on wall. Quads should burn." },
                    { name: "Glute Bridges", tip: "Squeeze glutes at top. Don't hyperextend back." }
                ],
                bands: [
                    { name: "Band Pull-Aparts", tip: "Arms straight, squeeze shoulder blades together. Upper back." },
                    { name: "Band Bicep Curls", tip: "Elbows pinned to sides. Control the negative." },
                    { name: "Band Overhead Press", tip: "Press straight up, don't flare elbows. Core engaged." },
                    { name: "Band Squats", tip: "Band above knees pushes them out. Focus on glute engagement." },
                    { name: "Band Rows", tip: "Pull to ribcage, squeeze shoulder blades. Feel upper back." },
                    { name: "Band Tricep Extensions", tip: "Keep elbows high and stable. Squeeze at extension." },
                    { name: "Band Lateral Walks", tip: "Stay low in squat. Feel glute medius on outer hip." }
                ],
                pullup: [
                    { name: "Pull-ups", tip: "Overhand grip. Pull chest to bar, control down. Lats and back." },
                    { name: "Chin-ups", tip: "Underhand grip. More bicep involvement. Chin over bar." },
                    { name: "Negative Pull-ups", tip: "Jump to top, lower slow (3-5 sec). Build pulling strength." },
                    { name: "Hanging Leg Raises", tip: "Legs together, no swinging. Core and hip flexors." },
                    { name: "Dead Hangs", tip: "Relax shoulders, decompress spine. Grip strength builder." }
                ],
                kettlebells: [
                    { name: "Kettlebell Swings", tip: "Hinge at hips, not squat. Power from glutes. Arms are just hooks." },
                    { name: "Goblet Squats", tip: "Hold KB at chest. Elbows inside knees. Deep squat." },
                    { name: "KB Deadlifts", tip: "Hinge at hips, flat back. Drive through heels." },
                    { name: "KB Rows", tip: "One arm at a time. Pull to hip, squeeze lat." },
                    { name: "KB Lunges", tip: "Hold KB at chest or sides. Control the descent." }
                ],
                dumbbells: [
                    { name: "Dumbbell Rows", tip: "One hand on bench. Pull to hip, squeeze back." },
                    { name: "DB Overhead Press", tip: "Start at shoulders, press straight up. Don't arch back." },
                    { name: "DB Lunges", tip: "DBs at sides. Step forward, control down and up." },
                    { name: "DB Curls", tip: "No swinging. Elbows pinned. Full range of motion." },
                    { name: "DB Tricep Extensions", tip: "One or both hands overhead. Lower behind head, extend." }
                ],
                barbell: [
                    { name: "Barbell Deadlift", tip: "Hinge at hips, flat back. Bar close to body. Drive through heels." },
                    { name: "Barbell Back Squat", tip: "Bar on upper back, not neck. Depth to parallel or below." },
                    { name: "Barbell Front Squat", tip: "Elbows high, bar on shoulders. Keep torso upright." },
                    { name: "Barbell Overhead Press", tip: "Start at shoulders, press straight up. Squeeze glutes for stability." },
                    { name: "Barbell Bent Over Row", tip: "Hinge forward 45¬∞, pull to belly button. Squeeze back." },
                    { name: "Barbell RDL", tip: "Slight knee bend, hinge at hips. Feel hamstrings stretch." },
                    { name: "Barbell Lunges", tip: "Bar on back, step forward. Keep torso upright." },
                    { name: "Barbell Floor Press", tip: "Lying on floor, press up. Great for triceps and lockout strength." },
                    { name: "Barbell Hip Thrust", tip: "Upper back on bench, bar on hips. Squeeze glutes at top." },
                    { name: "Barbell Good Mornings", tip: "Bar on back, hinge forward. Feel hamstrings and low back." }
                ],
                flatBench: [
                    { name: "Dumbbell Bench Press", tip: "DBs at chest level, press up and together. Control the negative." },
                    { name: "Dumbbell Flyes", tip: "Slight elbow bend, lower wide. Feel chest stretch." },
                    { name: "Bench Step-Ups", tip: "Drive through front heel. Alternate legs." },
                    { name: "Bench Hip Thrusts", tip: "Upper back on bench, drive hips up. Squeeze glutes." },
                    { name: "Incline Push-ups", tip: "Hands on bench, easier angle. Good for beginners." },
                    { name: "Bench Tricep Dips", tip: "Hands on edge, lower body. Elbows back, not out." },
                    { name: "Single-Leg Bench Squats", tip: "One foot on bench behind, squat on front leg. Bulgarian split squat." }
                ],
                adjBench: [
                    { name: "Incline Dumbbell Press", tip: "Bench at 30-45¬∞. Press up from upper chest." },
                    { name: "Incline Dumbbell Flyes", tip: "Bench at 30¬∞, arms wide. Upper chest focus." },
                    { name: "Seated Shoulder Press", tip: "Bench upright, press dumbbells overhead." },
                    { name: "Incline Dumbbell Rows", tip: "Chest on incline bench, pull DBs up. Upper back focus." },
                    { name: "Decline Push-ups", tip: "Feet on bench. Increases difficulty and shoulder engagement." },
                    { name: "Seated Incline Curls", tip: "Bench at 45¬∞, curl with stretch at bottom." },
                    { name: "Prone Y-T-W Raises", tip: "Lie face down on incline, raise arms in Y, T, W patterns. Shoulder health." }
                ],
                sled: [
                    { name: "Sled Push (High Handles)", tip: "Arms extended, drive with legs. Stay low and powerful." },
                    { name: "Sled Push (Low Handles)", tip: "Hands low, chest down. More quad and glute drive." },
                    { name: "Sled Pull (Backward)", tip: "Face sled, pull toward you walking backward. Quads burn." },
                    { name: "Sled Drag (Forward)", tip: "Strap around waist, walk forward. Great for conditioning." },
                    { name: "Sled Row", tip: "Face sled, row handle to chest. Upper back and biceps." },
                    { name: "Sled Sprint", tip: "Explosive push for 20-40 yards. Max effort." }
                ]
            },
            cardio: {
                indoor: [
                    { name: "High Knees (March/Run)", tip: "Drive knees up, pump arms. Keep core engaged.", reps: "30-45 seconds" },
                    { name: "Fast Feet Drill", tip: "Quick, light steps. Stay on balls of feet.", reps: "30 seconds" },
                    { name: "Seal Jacks", tip: "Arms out front instead of overhead. Low impact option.", reps: "20-30 reps" },
                    { name: "Mountain Climbers (Controlled)", tip: "Hips level with shoulders. Alternate knees to chest.", reps: "20-30 reps" },
                    { name: "Skater Jumps", tip: "Lateral jump, land soft. Touch opposite hand to foot.", reps: "10-15 per side" },
                    { name: "Burpees (No Push-up)", tip: "Squat, jump back to plank, hop forward, stand. Modify as needed.", reps: "10-15 reps" },
                    { name: "Lateral Shuffles", tip: "Stay low, quick side-to-side movement. 10 yards each direction.", reps: "30-45 seconds" },
                    { name: "Jog (Gym Laps)", tip: "1 lap around gym/basketball court. Light on feet, steady pace.", reps: "2-4 laps", isFinisher: true }
                ],
                outdoor: [
                    { name: "Sprint Intervals (100m)", tip: "Max effort sprint, walk 100m recovery. Repeat.", reps: "4-6 sprints" },
                    { name: "Shuttle Runs (25yd)", tip: "Touch line at each end. Explode out of turns.", reps: "4-6 shuttles" },
                    { name: "Hill Repeats", tip: "Sprint up, walk down. Drive knees on incline.", reps: "4-6 repeats" },
                    { name: "Linear Skips", tip: "Exaggerated skip, drive knee high. 25-50 yards.", reps: "2-4 lengths" },
                    { name: "Track Run (Steady State)", tip: "1 lap around the track at consistent pace. Breathe rhythmically.", reps: "1-2 laps", isFinisher: true },
                    { name: "400m Run", tip: "1 lap around the track at moderate pace. Control breathing.", reps: "1 lap", isFinisher: true },
                    { name: "Warrior Run (Last Runner Up)", tip: "Jog in formation, last person sprints to front. Repeat.", reps: "5-10 min", isFinisher: true }
                ],
                jumprope: [
                    { name: "Jump Rope (2 min)", tip: "Light bounces, wrists turn rope. Stay relaxed.", reps: "2 min" },
                    { name: "Jump Rope High Knees", tip: "Alternate high knees while jumping. Cardio + core.", reps: "1 min" },
                    { name: "Double Unders", tip: "Higher jump, faster wrist spin. Advanced skill.", reps: "20-30 reps" },
                    { name: "Jump Rope Intervals", tip: "30s fast, 30s easy. Build endurance.", reps: "3-4 rounds" }
                ],
                assaultBike: [
                    { name: "Assault Bike Intervals", tip: "15-30s max effort with full recovery. Push and pull with arms.", reps: "15-30s on / 45-60s rest x 6-8" },
                    { name: "Assault Bike Sprints", tip: "All-out effort, take full rest between. It's a killer!", reps: "20-30s sprint / 60s rest x 5-6" },
                    { name: "Assault Bike Steady State", tip: "Moderate pace, keep RPM consistent.", reps: "3-5 min", isFinisher: true },
                    { name: "Assault Bike Tabata", tip: "Maximum intensity. Take extra rest between sets if needed.", reps: "20s on / 10s off x 8 (rest 2 min, repeat)" },
                    { name: "Assault Bike Calorie Sprints", tip: "Sprint to hit target calories, rest fully between rounds.", reps: "10 cal sprint / 60s rest x 5-6 rounds" }
                ],
                rower: [
                    { name: "Rowing Intervals (500m)", tip: "500m hard, 1 min rest. Drive with legs first.", reps: "500m x 4-6 intervals" },
                    { name: "Rowing Sprints (250m)", tip: "All-out effort for 250m, rest 1 min between.", reps: "250m x 5-6 sprints" },
                    { name: "Rowing Steady State (2000m)", tip: "Moderate pace 18-22 strokes/min. Focus on form.", reps: "2000m", isFinisher: true },
                    { name: "Rowing Pyramid", tip: "250m-500m-750m-500m-250m. Control pace on longer pieces.", reps: "2250m total" },
                    { name: "Rowing 1000m", tip: "Build pace throughout. Sprint last 200m.", reps: "1000m" }
                ],
                cycle: [
                    { name: "Cycling Intervals", tip: "1 min high resistance, 1 min low. Maintain cadence.", reps: "6-8 rounds" },
                    { name: "Cycling Sprints", tip: "30s max speed, 30s easy. Seated or standing.", reps: "6-8 sprints" },
                    { name: "Cycling Steady State", tip: "Moderate resistance, consistent pace. Good recovery.", reps: "5-10 min", isFinisher: true },
                    { name: "Cycling Hills", tip: "Increase resistance, stand and climb. 1 min on, 1 min off.", reps: "5-6 hills" },
                    { name: "Cycling Tabata", tip: "20s sprint, 10s rest x 8. High cadence.", reps: "4 min" }
                ],
                treadmill: [
                    { name: "Treadmill Intervals", tip: "1 min sprint, 1 min walk. Adjust speed for ability.", reps: "6-8 rounds" },
                    { name: "Treadmill Sprints", tip: "30s at 80-90% effort, 30s rest. Hold rails to hop on/off.", reps: "6-8 sprints" },
                    { name: "Incline Walk", tip: "10-15% incline, moderate pace. Great for glutes and calves.", reps: "5-10 min", isFinisher: true },
                    { name: "Treadmill Run", tip: "Steady pace jog. Focus on breathing rhythm.", reps: "5-10 min", isFinisher: true },
                    { name: "Incline Sprints", tip: "5-8% incline, sprint 20s, rest 40s. Power builder.", reps: "5-6 sprints" }
                ]
            },
            yoga: [
                { name: "Cat-Cow Stretch", duration: "30-45 seconds", tip: "Flow between arching and rounding back. Sync with breath." },
                { name: "Child's Pose", duration: "30-60 seconds", tip: "Knees wide, arms extended. Rest forehead on mat." },
                { name: "Downward Dog", duration: "30-45 seconds", tip: "Hips high, heels reaching down. Press hands into mat." },
                { name: "Forward Fold", duration: "30-45 seconds", tip: "Let head hang heavy. Bend knees if hamstrings tight." },
                { name: "Low Lunge", duration: "30 seconds/side", tip: "Back knee down, hips sink forward. Hip flexor stretch." },
                { name: "Pigeon Pose", duration: "45-60 seconds/side", tip: "Front shin across mat. Deep hip opener." },
                { name: "Seated Twist", duration: "30 seconds/side", tip: "Tall spine, twist from core. Look over back shoulder." },
                { name: "Thread the Needle", duration: "30-45 seconds/side", tip: "On all fours, reach arm under body. Shoulder stretch." },
                { name: "Supine Twist", duration: "30-45 seconds/side", tip: "Lying on back, knees to one side. Arms out in T." },
                { name: "Cobra Pose", duration: "20-30 seconds", tip: "Gentle backbend, shoulders down. Don't strain neck." },
                { name: "Butterfly Stretch", duration: "30-60 seconds", tip: "Soles of feet together, knees drop. Inner thigh stretch." },
                { name: "Happy Baby", duration: "30-45 seconds", tip: "Grab outside of feet, rock gently. Low back release." },
                { name: "Figure Four Stretch", duration: "30-45 seconds/side", tip: "Ankle on opposite knee, pull thigh in. Piriformis stretch." },
                { name: "Supine Hamstring Stretch", duration: "30-45 seconds/side", tip: "Leg straight up, use strap or hands. Keep other leg flat." },
                { name: "Neck Rolls", duration: "30 seconds each direction", tip: "Slow circles, release tension. Don't force range." },
                { name: "Shoulder Rolls", duration: "30 seconds", tip: "Roll forward then backward. Release upper body tension." },
                { name: "Wrist Circles", duration: "20-30 seconds each direction", tip: "Circle wrists both ways. Good for desk workers." },
                { name: "Standing Side Stretch", duration: "20-30 seconds/side", tip: "Reach arm overhead, lean to opposite side. Stretch obliques." },
                { name: "Warrior I", duration: "30 seconds/side", tip: "Front knee bent, back leg straight. Arms reach up." },
                { name: "Warrior II", duration: "30 seconds/side", tip: "Arms parallel to ground, gaze over front hand. Strong legs." },
                { name: "Triangle Pose", duration: "30 seconds/side", tip: "Front leg straight, reach down and up. Open chest." },
                { name: "Tree Pose", duration: "30 seconds/side", tip: "Foot on inner thigh or calf. Balance practice." },
                { name: "Corpse Pose (Savasana)", duration: "2-3 minutes", tip: "Final relaxation. Lie completely still, focus on breath." }
            ],
            funday: {
                outdoor: [
                    { name: "Kickball", tip: "Split into teams. Standard baseball rules with a rubber ball. Great for all fitness levels." },
                    { name: "Ultimate Frisbee", tip: "Non-contact sport. Score by catching in end zone. No running with disc." },
                    { name: "Flag Football", tip: "Two-hand touch or flag pull. Set clear boundaries and end zones." },
                    { name: "Soccer", tip: "Full field or small-sided games. Rotate goalies every 10 min." },
                    { name: "Softball", tip: "Slow pitch recommended. Rotate positions each inning." },
                    { name: "Capture the Flag", tip: "Two teams, two territories. Great for unit cohesion and strategy." },
                    { name: "Relay Races", tip: "Mix up distances and styles. Include fun variations like wheelbarrow, three-legged, etc." },
                    { name: "Tug of War", tip: "Equal teams by total weight. Best 2 of 3 rounds. Watch footing." },
                    { name: "Obstacle Course", tip: "Set up stations with cones, hurdles, crawls. Time each team." }
                ],
                indoor: [
                    { name: "Basketball", tip: "Full court or half court games. Rotate teams every 10-15 min." },
                    { name: "Volleyball", tip: "Rally scoring to 25. Rotate servers. Modify net height as needed." },
                    { name: "Dodgeball", tip: "Soft balls only. Clear boundaries. Eliminated players do exercises on sideline." },
                    { name: "Indoor Soccer (Futsal)", tip: "Smaller teams, smaller goals. No walls - out of bounds rules apply." },
                    { name: "Floor Hockey", tip: "Plastic sticks and puck. No high sticking. Rotate goalies." },
                    { name: "Badminton", tip: "Singles or doubles. Rally scoring to 21." },
                    { name: "Team Handball", tip: "Soccer meets basketball. Throw ball into goal. No running with ball." },
                    { name: "Pickleball", tip: "Easy to learn. Great for mixed fitness levels. Doubles recommended." },
                    { name: "Musical Fitness", tip: "Music stops, everyone does called exercise. Fun and unpredictable." }
                ]
            }
        };

        // --- Equipment Toggle Logic ---

        function toggleNone() {
            const noneBox = document.getElementById('equipNone');
            const equipItems = document.querySelectorAll('.equip-item');
            const noneLabel = noneBox.closest('.equip-checkbox');

            if (noneBox.checked) {
                equipItems.forEach(item => {
                    item.checked = false;
                    item.closest('.equip-checkbox').classList.remove('none-selected');
                });
                noneLabel.classList.add('none-selected');
            }
        }

        function equipChanged() {
            const noneBox = document.getElementById('equipNone');
            const noneLabel = noneBox.closest('.equip-checkbox');
            const equipItems = document.querySelectorAll('.equip-item');
            const anyChecked = Array.from(equipItems).some(item => item.checked);

            if (anyChecked) {
                noneBox.checked = false;
                noneLabel.classList.remove('none-selected');
            } else {
                noneBox.checked = true;
                noneLabel.classList.add('none-selected');
            }
        }

        function getSelectedEquipment() {
            return {
                bands: document.getElementById('equipBands').checked,
                pullup: document.getElementById('equipPullup').checked,
                kettlebells: document.getElementById('equipKettlebells').checked,
                dumbbells: document.getElementById('equipDumbbells').checked,
                jumprope: document.getElementById('equipJumprope').checked,
                barbell: document.getElementById('equipBarbell').checked,
                flatBench: document.getElementById('equipFlatBench').checked,
                adjBench: document.getElementById('equipAdjBench').checked,
                sled: document.getElementById('equipSled').checked,
                assaultBike: document.getElementById('equipAssaultBike').checked,
                rower: document.getElementById('equipRower').checked,
                cycle: document.getElementById('equipCycle').checked,
                treadmill: document.getElementById('equipTreadmill').checked
            };
        }

        // --- Focus Change Handler (update rep schemes for cardio-only, disable for fun day) ---

        function updateSchemeOptions() {
            const focus = document.getElementById('focusSelect').value;
            const schemeSelect = document.getElementById('schemeSelect');
            const currentValue = schemeSelect.value;

            // Fun Day - disable rep scheme selector
            if (focus === 'funday') {
                schemeSelect.disabled = true;
                schemeSelect.innerHTML = '<option value="funday">N/A - Team Sports</option>';
                return;
            }

            // Yoga Day - disable rep scheme selector
            if (focus === 'yoga') {
                schemeSelect.disabled = true;
                schemeSelect.innerHTML = '<option value="yoga">N/A - Time-Based Stretching</option>';
                return;
            }

            // Re-enable if coming back from fun day or yoga
            schemeSelect.disabled = false;

            // All available schemes
            const allSchemes = [
                { value: 'surprise', text: 'Surprise Me!' },
                { value: 'circuit', text: 'Circuit (3 Rounds x Reps)' },
                { value: 'hiit', text: 'HIIT (40s Work / 20s Rest)' },
                { value: 'military', text: 'Military 4-Count (10 reps)' },
                { value: 'pyramid', text: 'Pyramid (2-4-6-8-10)' },
                { value: 'reversePyramid', text: 'Reverse Pyramid (10-8-6-4-2)' }
            ];

            // Cardio-only appropriate schemes
            const cardioSchemes = [
                { value: 'surprise', text: 'Surprise Me!' },
                { value: 'circuit', text: 'Circuit (3 Rounds x Time)' },
                { value: 'hiit', text: 'HIIT (40s Work / 20s Rest)' }
            ];

            const schemes = (focus === 'cardio') ? cardioSchemes : allSchemes;

            // Clear and rebuild options
            schemeSelect.innerHTML = '';
            schemes.forEach(s => {
                const option = document.createElement('option');
                option.value = s.value;
                option.textContent = s.text;
                schemeSelect.appendChild(option);
            });

            // Try to restore previous selection, or default to first
            const validValues = schemes.map(s => s.value);
            if (validValues.includes(currentValue)) {
                schemeSelect.value = currentValue;
            }
        }

        function updateEquipmentOptions() {
            const focus = document.getElementById('focusSelect').value;
            const equipmentGrid = document.getElementById('equipmentGrid');
            const equipmentCheckboxes = document.querySelectorAll('.equip-checkbox');

            // Disable equipment for Fun Day and Chill Day (Yoga)
            if (focus === 'funday' || focus === 'yoga') {
                equipmentGrid.classList.add('disabled');
                equipmentCheckboxes.forEach(checkbox => {
                    checkbox.classList.add('disabled');
                });
            } else {
                equipmentGrid.classList.remove('disabled');
                equipmentCheckboxes.forEach(checkbox => {
                    checkbox.classList.remove('disabled');
                });
            }
        }

        // Initialize on page load and on focus change
        document.getElementById('focusSelect').addEventListener('change', function() {
            updateSchemeOptions();
            updateEquipmentOptions();
        });

        // --- Collapsible Section Toggle ---

        function toggleSection(id) {
            const el = document.getElementById(id);
            const header = el.previousElementSibling;
            if (el.style.display === 'none') {
                el.style.display = 'block';
                header.querySelector('.toggle-icon').textContent = '‚ñº';
            } else {
                el.style.display = 'none';
                header.querySelector('.toggle-icon').textContent = '‚ñ∂';
            }
        }

        // --- Render Helpers ---

        function getSearchLink(term) {
            return `https://www.google.com/search?q=${encodeURIComponent(term + " exercise technique")}+site:youtube.com`;
        }

        function renderItem(name, meta, tip = null) {
            const tipHtml = tip ? `<div style="margin-top:5px; font-size:0.85em; color:#ffd700; font-style:italic;">üí° ${tip}</div>` : '';
            return `
                <li class="exercise-item">
                    <span class="exercise-name">${name}</span>
                    <div class="exercise-meta">${meta}</div>${tipHtml}
                    <a href="${getSearchLink(name)}" target="_blank" class="search-link">‚ñ∂ Watch Demo</a>
                </li>
            `;
        }

        function renderCollapsibleHeader(title, contentId, expanded = true) {
            const icon = expanded ? '‚ñº' : '‚ñ∂';
            return `<div class="section-header" style="cursor:pointer;" onclick="toggleSection('${contentId}')">
                        <span class="toggle-icon">${icon}</span> ${title}
                    </div>`;
        }

        // --- Main Generate Function ---

        function generateWorkout() {
            const focus = document.getElementById('focusSelect').value;
            const location = document.getElementById('locationSelect').value;
            let scheme = document.getElementById('schemeSelect').value;
            const equip = getSelectedEquipment();
            const out = document.getElementById('workoutOutput');

            // Scheme descriptions
            const schemeDesc = {
                circuit: { meta: "3 Rounds x 12-15 Reps", note: "Perform as a circuit. Rest 60s between rounds." },
                hiit: { meta: "40s Work / 20s Rest", note: "Tabata style. Complete 3-4 rounds of all exercises." },
                military: { meta: "10 Reps (4-Count)", note: "CFL leads count: 1-2-3-ONE... to 1-2-3-TEN. Planks: 15+ echo count." },
                pyramid: { meta: "Pyramid: 2-4-6-8-10", note: "Build up reps each round. Rest as needed between rounds." },
                reversePyramid: { meta: "Reverse Pyramid: 10-8-6-4-2", note: "Decrease reps each round. Stay strong as fatigue sets in." }
            };

            // Handle "Surprise Me" - pick random scheme appropriate for focus
            if (scheme === 'surprise') {
                if (focus === 'cardio') {
                    // Cardio-only: HIIT is most appropriate, or circuit with time-based
                    const cardioSchemes = ['hiit', 'circuit'];
                    scheme = cardioSchemes[Math.floor(Math.random() * cardioSchemes.length)];
                } else {
                    // Strength or Mixed: any scheme works
                    const allSchemes = ['circuit', 'hiit', 'military', 'pyramid', 'reversePyramid'];
                    scheme = allSchemes[Math.floor(Math.random() * allSchemes.length)];
                }
            }

            // Check if exercise is a plank-type exercise
            function isPlankExercise(name) {
                const plankKeywords = ['plank', 'pillar bridge'];
                return plankKeywords.some(keyword => name.toLowerCase().includes(keyword));
            }

            // Check if exercise is cardio (has built-in reps)
            function isCardioExercise(exercise) {
                return exercise.reps !== undefined;
            }

            // Get exercise-specific rep scheme
            function getExerciseReps(exercise, scheme) {
                // Cardio exercises use their own reps
                if (isCardioExercise(exercise)) {
                    return exercise.reps;
                }

                // Planks use echo count for military 4-count
                if (scheme === 'military' && isPlankExercise(exercise.name)) {
                    return "15-20 Echo Count";
                }

                // Standard scheme reps
                return schemeDesc[scheme].meta;
            }

            // 1. Warmup (Collapsible - collapsed by default)
            let html = renderCollapsibleHeader('1. Standardized Warm-Up (10-12 Min)', 'warmupContent', false);
            html += `<ul class="exercise-list" id="warmupContent" style="display:none">`;
            warmupExercises.forEach(ex => html += renderItem(ex.name, ex.rep));

            if (focus === 'mixed' || focus === 'cardio' || focus === 'funday') {
                html += `<li style="padding:10px; color:#4a90e2; font-weight:bold; background:none; border:none;">‚Äî Pre-Cardio Additions ‚Äî</li>`;
                preCardioWarmup.forEach(ex => html += renderItem(ex.name, ex.rep));
            }
            html += `</ul>`;

            // Handle Fun Day separately
            if (focus === 'funday') {
                const fundayActivities = location === 'indoor' ? db.funday.indoor : db.funday.outdoor;
                const shuffled = fundayActivities.sort(() => 0.5 - Math.random());
                const primary = shuffled[0];
                const alternatives = shuffled.slice(1, 4);

                html += `<div class="section-header">2. Fun Day Activity (40-45 Min)</div>`;
                html += `<p style="margin-bottom:15px; padding:15px; background:rgba(255,215,0,0.1); border-radius:8px; border:1px solid rgba(255,215,0,0.3); font-size:0.95em;">
                            <strong style="color:#ffd700; font-size:1.2em;">Today's Activity: ${primary.name}</strong><br>
                            <span style="color:#8fa3bf;">üí° ${primary.tip}</span>
                         </p>`;

                html += `<p style="margin-bottom:10px; color:#8fa3bf; font-size:0.9em;"><strong>Alternative Options:</strong></p>`;
                html += `<ul class="exercise-list">`;
                alternatives.forEach(activity => {
                    html += renderItem(activity.name, "Team Sport", activity.tip);
                });
                html += `</ul>`;

                html += `<p style="margin-top:15px; padding:12px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.85em; color:#8fa3bf;">
                            <strong>CFL Tips:</strong> Ensure equal teams, establish clear rules before starting, rotate positions/teams regularly,
                            and keep water breaks every 15-20 min. Focus on participation over competition.
                         </p>`;

                // Skip to cool-down for fun day (collapsed by default)
                html += renderCollapsibleHeader('3. Cool-Down (5-8 Min)', 'cooldownContent', false);
                html += `<ul class="exercise-list" id="cooldownContent" style="display:none">`;
                cooldownExercises.forEach(ex => html += renderItem(ex.name, ex.desc, ex.tip));
                html += `</ul>`;

                out.innerHTML = html;
                out.style.display = 'block';
                out.scrollIntoView({ behavior: 'smooth' });
                return; // Exit early for fun day
            }

            // Handle Yoga/Chill Day separately (no warmup/cooldown needed)
            if (focus === 'yoga') {
                const yogaPoses = [...db.yoga].sort(() => 0.5 - Math.random());
                const selectedPoses = yogaPoses.slice(0, 12); // Select 12 poses

                // Always end with Corpse Pose (Savasana) if not already included
                const savasana = db.yoga.find(p => p.name.includes('Savasana'));
                const hasSavasana = selectedPoses.some(p => p.name.includes('Savasana'));
                if (!hasSavasana && savasana) {
                    selectedPoses.pop();
                    selectedPoses.push(savasana);
                }

                let html = `<div class="section-header">üßò Chill Day - Yoga & Stretching (45-60 Min)</div>`;
                html += `<p style="margin-bottom:15px; padding:15px; background:rgba(147,112,219,0.15); border-radius:8px; border:1px solid rgba(147,112,219,0.3); font-size:0.95em;">
                            <strong style="color:#9370db;">Today's Focus: Recovery & Relaxation</strong><br>
                            <span style="color:#8fa3bf;">Move slowly, breathe deeply, and listen to your body. Hold each pose for the indicated time.</span>
                         </p>`;

                html += `<ul class="exercise-list">`;
                selectedPoses.forEach(pose => {
                    html += renderItem(pose.name, pose.duration, pose.tip);
                });
                html += `</ul>`;

                html += `<p style="margin-top:15px; padding:12px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.85em; color:#8fa3bf;">
                            <strong>CFL Tips:</strong> Dim lights if possible, play calming music, encourage deep breathing throughout.
                            Remind participants to never push through pain - modifications are always okay.
                         </p>`;

                out.innerHTML = html;
                out.style.display = 'block';
                out.scrollIntoView({ behavior: 'smooth' });
                return; // Exit early for yoga day
            }

            // 2. Main Workout (for non-fun day)
            html += `<div class="section-header">2. Main Session (${focus.toUpperCase()} - 40 Min)</div>`;
            html += `<p style="margin-bottom:15px; padding:10px; background:rgba(74,144,226,0.1); border-radius:6px; font-size:0.9em;">
                        <strong>Format:</strong> ${schemeDesc[scheme].meta}<br>
                        <em>${schemeDesc[scheme].note}</em>
                     </p>`;
            html += `<ul class="exercise-list">`;

            let mainPool = [];

            if (focus !== 'cardio') {
                mainPool = [...mainPool, ...db.strength.bodyweight];
                if (equip.bands) mainPool = [...mainPool, ...db.strength.bands];
                if (equip.pullup) mainPool = [...mainPool, ...db.strength.pullup];
                if (equip.kettlebells) mainPool = [...mainPool, ...db.strength.kettlebells];
                if (equip.dumbbells) mainPool = [...mainPool, ...db.strength.dumbbells];
                if (equip.barbell) mainPool = [...mainPool, ...db.strength.barbell];
                if (equip.flatBench) mainPool = [...mainPool, ...db.strength.flatBench];
                if (equip.adjBench) mainPool = [...mainPool, ...db.strength.adjBench];
                if (equip.sled) mainPool = [...mainPool, ...db.strength.sled];
            }

            if (focus !== 'strength') {
                mainPool = [...mainPool, ...(location === 'indoor' ? db.cardio.indoor : db.cardio.outdoor)];
                if (equip.jumprope) mainPool = [...mainPool, ...db.cardio.jumprope];
                if (equip.assaultBike) mainPool = [...mainPool, ...db.cardio.assaultBike];
                if (equip.rower) mainPool = [...mainPool, ...db.cardio.rower];
                if (equip.cycle) mainPool = [...mainPool, ...db.cardio.cycle];
                if (equip.treadmill) mainPool = [...mainPool, ...db.cardio.treadmill];
            }

            // Separate finishers from regular exercises
            const regularExercises = mainPool.filter(ex => !ex.isFinisher);
            const finisherExercises = mainPool.filter(ex => ex.isFinisher);

            // Shuffle both pools
            const shuffledRegular = regularExercises.sort(() => 0.5 - Math.random());
            const shuffledFinishers = finisherExercises.sort(() => 0.5 - Math.random());

            // Select exercises: fill with regular first, then add one finisher at end if available
            const count = 8;
            let selected = [];

            // Take regular exercises (leave room for 1 finisher if we have finishers)
            const regularCount = shuffledFinishers.length > 0 ? Math.min(count - 1, shuffledRegular.length) : Math.min(count, shuffledRegular.length);
            selected = shuffledRegular.slice(0, regularCount);

            // Add one finisher at the end if available and we have room
            if (shuffledFinishers.length > 0 && selected.length < count) {
                selected.push(shuffledFinishers[0]);
            }

            // Fill remaining slots with more regular exercises if needed
            if (selected.length < count && shuffledRegular.length > regularCount) {
                const remaining = shuffledRegular.slice(regularCount, regularCount + (count - selected.length));
                // Insert before the finisher if one exists
                if (shuffledFinishers.length > 0 && selected.length > 0 && selected[selected.length - 1].isFinisher) {
                    const finisher = selected.pop();
                    selected = [...selected, ...remaining, finisher];
                } else {
                    selected = [...selected, ...remaining];
                }
            }

            selected.forEach(ex => {
                const reps = getExerciseReps(ex, scheme);
                html += renderItem(ex.name, reps, ex.tip);
            });
            html += `</ul>`;

            // 3. Cool-Down (Collapsible - collapsed by default)
            html += renderCollapsibleHeader('3. Cool-Down (5-8 Min)', 'cooldownContent', false);
            html += `<ul class="exercise-list" id="cooldownContent" style="display:none">`;
            cooldownExercises.forEach(ex => html += renderItem(ex.name, ex.desc, ex.tip));
            html += `</ul>`;

            out.innerHTML = html;
            out.style.display = 'block';
            out.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>

</html>
